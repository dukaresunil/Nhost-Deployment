(function(S,y){typeof exports=="object"&&typeof module!="undefined"?y(exports):typeof define=="function"&&define.amd?define(["exports"],y):(S=typeof globalThis!="undefined"?globalThis:S||self,y(S["@nhost/core"]={}))})(this,function(S){"use strict";/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var y=function(){return y=Object.assign||function(e){for(var r,n=1,i=arguments.length;n<i;n++){r=arguments[n];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},y.apply(this,arguments)};function Et(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]]);return r}function b(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function A(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(a)throw a.error}}return s}function D(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))}var P;(function(t){t.Start="xstate.start",t.Stop="xstate.stop",t.Raise="xstate.raise",t.Send="xstate.send",t.Cancel="xstate.cancel",t.NullEvent="",t.Assign="xstate.assign",t.After="xstate.after",t.DoneState="done.state",t.DoneInvoke="done.invoke",t.Log="xstate.log",t.Init="xstate.init",t.Invoke="xstate.invoke",t.ErrorExecution="error.execution",t.ErrorCommunication="error.communication",t.ErrorPlatform="error.platform",t.ErrorCustom="xstate.error",t.Update="xstate.update",t.Pure="xstate.pure",t.Choose="xstate.choose"})(P||(P={}));var se;(function(t){t.Parent="#_parent",t.Internal="#_internal"})(se||(se={}));var wt=P.Start,St=P.Stop,he=P.Raise,ve=P.Send,sr=P.Cancel,In=P.NullEvent,Tt=P.Assign;P.After,P.DoneState;var ar=P.Log,_n=P.Init,Rt=P.Invoke;P.ErrorExecution;var or=P.ErrorPlatform,Nn=P.ErrorCustom,ur=P.Update,Pn=P.Choose,Cn=P.Pure,cr=".",lr={},bt="xstate.guard",Dn="",kn=!0,Ge;function At(t,e,r){r===void 0&&(r=cr);var n=De(t,r),i=De(e,r);return _(i)?_(n)?i===n:!1:_(n)?n in i:Object.keys(n).every(function(s){return s in i?At(n[s],i[s]):!1})}function fr(t){try{return _(t)||typeof t=="number"?"".concat(t):t.type}catch{throw new Error("Events must be strings or objects with a string event.type property.")}}function Ot(t,e){try{return pe(t)?t:t.toString().split(e)}catch{throw new Error("'".concat(t,"' is not a valid state path."))}}function Un(t){return typeof t=="object"&&"value"in t&&"context"in t&&"event"in t&&"_event"in t}function De(t,e){if(Un(t))return t.value;if(pe(t))return He(t);if(typeof t!="string")return t;var r=Ot(t,e);return He(r)}function He(t){if(t.length===1)return t[0];for(var e={},r=e,n=0;n<t.length-1;n++)n===t.length-2?r[t[n]]=t[n+1]:(r[t[n]]={},r=r[t[n]]);return e}function ke(t,e){for(var r={},n=Object.keys(t),i=0;i<n.length;i++){var s=n[i];r[s]=e(t[s],s,t,i)}return r}function dr(t,e,r){var n,i,s={};try{for(var a=b(Object.keys(t)),o=a.next();!o.done;o=a.next()){var u=o.value,f=t[u];!r(f)||(s[u]=e(f,u,t))}}catch(c){n={error:c}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s}var Ln=function(t){return function(e){var r,n,i=e;try{for(var s=b(t),a=s.next();!a.done;a=s.next()){var o=a.value;i=i[o]}}catch(u){r={error:u}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return i}};function Mn(t,e){return function(r){var n,i,s=r;try{for(var a=b(t),o=a.next();!o.done;o=a.next()){var u=o.value;s=s[e][u]}}catch(f){n={error:f}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s}}function We(t){if(!t)return[[]];if(_(t))return[[t]];var e=L(Object.keys(t).map(function(r){var n=t[r];return typeof n!="string"&&(!n||!Object.keys(n).length)?[[r]]:We(t[r]).map(function(i){return[r].concat(i)})}));return e}function L(t){var e;return(e=[]).concat.apply(e,D([],A(t),!1))}function hr(t){return pe(t)?t:[t]}function z(t){return t===void 0?[]:hr(t)}function ze(t,e,r){var n,i;if(C(t))return t(e,r.data);var s={};try{for(var a=b(Object.keys(t)),o=a.next();!o.done;o=a.next()){var u=o.value,f=t[u];C(f)?s[u]=f(e,r.data):s[u]=f}}catch(c){n={error:c}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s}function jn(t){return/^(done|error)\./.test(t)}function vr(t){return!!(t instanceof Promise||t!==null&&(C(t)||typeof t=="object")&&C(t.then))}function $n(t){return t!==null&&typeof t=="object"&&"transition"in t&&typeof t.transition=="function"}function Fn(t,e){var r,n,i=A([[],[]],2),s=i[0],a=i[1];try{for(var o=b(t),u=o.next();!u.done;u=o.next()){var f=u.value;e(f)?s.push(f):a.push(f)}}catch(c){r={error:c}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return[s,a]}function pr(t,e){return ke(t.states,function(r,n){if(!!r){var i=(_(e)?void 0:e[n])||(r?r.current:void 0);if(!!i)return{current:i,states:pr(r,i)}}})}function Vn(t,e){return{current:e,states:pr(t,e)}}function mr(t,e,r,n){var i=t&&r.reduce(function(s,a){var o,u,f=a.assignment,c={state:n,action:a,_event:e},p={};if(C(f))p=f(s,e.data,c);else try{for(var h=b(Object.keys(f)),l=h.next();!l.done;l=h.next()){var d=l.value,v=f[d];p[d]=C(v)?v(s,e.data,c):v}}catch(m){o={error:m}}finally{try{l&&!l.done&&(u=h.return)&&u.call(h)}finally{if(o)throw o.error}}return Object.assign({},s,p)},t);return i}var Bn=function(){};function pe(t){return Array.isArray(t)}function C(t){return typeof t=="function"}function _(t){return typeof t=="string"}function yr(t,e){if(!!t)return _(t)?{type:bt,name:t,predicate:e?e[t]:void 0}:C(t)?{type:bt,name:t.name,predicate:t}:t}function qn(t){try{return"subscribe"in t&&C(t.subscribe)}catch{return!1}}var ae=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();Ge={},Ge[ae]=function(){return this},Ge[Symbol.observable]=function(){return this};function me(t){return!!t&&"__xstatenode"in t}function Kn(t){return!!t&&typeof t.send=="function"}function xt(t,e){return _(t)||typeof t=="number"?y({type:t},e):t}function $(t,e){if(!_(t)&&"$$type"in t&&t.$$type==="scxml")return t;var r=xt(t);return y({name:r.type,data:r,$$type:"scxml",type:"external"},e)}function ye(t,e){var r=hr(e).map(function(n){return typeof n=="undefined"||typeof n=="string"||me(n)?{target:n,event:t}:y(y({},n),{event:t})});return r}function Gn(t){if(!(t===void 0||t===Dn))return z(t)}function gr(t,e,r,n,i){var s=t.options.guards,a={state:i,cond:e,_event:n};if(e.type===bt)return((s==null?void 0:s[e.name])||e.predicate)(r,n.data,a);var o=s==null?void 0:s[e.type];if(!o)throw new Error("Guard '".concat(e.type,"' is not implemented on machine '").concat(t.id,"'."));return o(r,n.data,a)}function Er(t){return typeof t=="string"?{type:t}:t}function Ye(t,e,r){var n=function(){},i=typeof t=="object",s=i?t:null;return{next:((i?t.next:t)||n).bind(s),error:((i?t.error:e)||n).bind(s),complete:((i?t.complete:r)||n).bind(s)}}function Je(t,e){return"".concat(t,":invocation[").concat(e,"]")}var ge=$({type:_n});function It(t,e){return e&&e[t]||void 0}function Ue(t,e){var r;if(_(t)||typeof t=="number"){var n=It(t,e);C(n)?r={type:t,exec:n}:n?r=n:r={type:t,exec:void 0}}else if(C(t))r={type:t.name||t.toString(),exec:t};else{var n=It(t.type,e);if(C(n))r=y(y({},t),{exec:n});else if(n){var i=n.type||t.type;r=y(y(y({},n),t),{type:i})}else r=t}return r}var oe=function(t,e){if(!t)return[];var r=pe(t)?t:[t];return r.map(function(n){return Ue(n,e)})};function _t(t){var e=Ue(t);return y(y({id:_(t)?t:e.id},e),{type:e.type})}function Hn(t){return _(t)?{type:he,event:t}:Nt(t,{to:se.Internal})}function Wn(t){return{type:he,_event:$(t.event)}}function Nt(t,e){return{to:e?e.to:void 0,type:ve,event:C(t)?t:xt(t),delay:e?e.delay:void 0,id:e&&e.id!==void 0?e.id:C(t)?t.name:fr(t)}}function zn(t,e,r,n){var i={_event:r},s=$(C(t.event)?t.event(e,r.data,i):t.event),a;if(_(t.delay)){var o=n&&n[t.delay];a=C(o)?o(e,r.data,i):o}else a=C(t.delay)?t.delay(e,r.data,i):t.delay;var u=C(t.to)?t.to(e,r.data,i):t.to;return y(y({},t),{to:u,_event:s,event:s.data,delay:a})}var Yn=function(t,e,r){return y(y({},t),{value:_(t.expr)?t.expr:t.expr(e,r.data,{_event:r})})},Jn=function(t){return{type:sr,sendId:t}};function Qn(t){var e=_t(t);return{type:P.Start,activity:e,exec:void 0}}function Xn(t){var e=C(t)?t:_t(t);return{type:P.Stop,activity:e,exec:void 0}}function Zn(t,e,r){var n=C(t.activity)?t.activity(e,r.data):t.activity,i=typeof n=="string"?{id:n}:n,s={type:P.Stop,activity:i};return s}var ei=function(t){return{type:Tt,assignment:t}};function ti(t,e){var r=e?"#".concat(e):"";return"".concat(P.After,"(").concat(t,")").concat(r)}function Qe(t,e){var r="".concat(P.DoneState,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Xe(t,e){var r="".concat(P.DoneInvoke,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}function Le(t,e){var r="".concat(P.ErrorPlatform,".").concat(t),n={type:r,data:e};return n.toString=function(){return r},n}var ri=function(t){var e,r,n=[];try{for(var i=b(t),s=i.next();!s.done;s=i.next())for(var a=s.value,o=0;o<a.length;){if(a[o].type===Tt){n.push(a[o]),a.splice(o,1);continue}o++}}catch(u){e={error:u}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n};function Ze(t,e,r,n,i,s,a){a===void 0&&(a=!1);var o=a?[]:ri(i),u=o.length?mr(r,n,o,e):r,f=a?[r]:void 0,c=[];function p(d){var v;switch(d.type){case he:return Wn(d);case ve:var m=zn(d,u,n,t.options.delays);return s&&m.to!==se.Internal&&c.push(m),m;case ar:{var E=Yn(d,u,n);return s==null||s(E,u,n),E}case Pn:{var g=d,w=(v=g.conds.find(function(Q){var ie=yr(Q.cond,t.options.guards);return!ie||gr(t,ie,u,n,s?void 0:e)}))===null||v===void 0?void 0:v.actions;if(!w)return[];var x=A(Ze(t,e,u,n,[oe(z(w),t.options.actions)],s,a),2),R=x[0],U=x[1];return u=U,f==null||f.push(u),R}case Cn:{var w=d.get(u,n.data);if(!w)return[];var O=A(Ze(t,e,u,n,[oe(z(w),t.options.actions)],s,a),2),I=O[0],N=O[1];return u=N,f==null||f.push(u),I}case St:{var E=Zn(d,u,n);return s==null||s(E,r,n),E}case Tt:{u=mr(u,n,[d],s?void 0:e),f==null||f.push(u);break}default:var T=Ue(d,t.options.actions),k=T.exec;if(s)s(T,u,n);else if(k&&f){var H=f.length-1;T=y(y({},T),{exec:function(Q){for(var ie=[],Ne=1;Ne<arguments.length;Ne++)ie[Ne-1]=arguments[Ne];k.apply(void 0,D([f[H]],A(ie),!1))}})}return T}}function h(d){var v,m,E=[];try{for(var g=b(d),w=g.next();!w.done;w=g.next()){var x=w.value,R=p(x);R&&(E=E.concat(R))}}catch(U){v={error:U}}finally{try{w&&!w.done&&(m=g.return)&&m.call(g)}finally{if(v)throw v.error}}return c.forEach(function(U){s(U,u,n)}),c.length=0,E}var l=L(i.map(h));return[l,u]}var Ee=function(t,e){var r=e(t);return r};function wr(t){var e;return e={id:t,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},getSnapshot:function(){},toJSON:function(){return{id:t}}},e[ae]=function(){return this},e}function ni(t,e,r,n){var i,s=Er(t.src),a=(i=e==null?void 0:e.options.services)===null||i===void 0?void 0:i[s.type],o=t.data?ze(t.data,r,n):void 0,u=a?Sr(a,t.id,o):wr(t.id);return u.meta=t,u}function Sr(t,e,r){var n=wr(e);if(n.deferred=!0,me(t)){var i=n.state=Ee(void 0,function(){return(r?t.withContext(r):t).initialState});n.getSnapshot=function(){return i}}return n}function ii(t){try{return typeof t.send=="function"}catch{return!1}}function si(t){return ii(t)&&"id"in t}function ai(t){var e;return y((e={subscribe:function(){return{unsubscribe:function(){}}},id:"anonymous",getSnapshot:function(){}},e[ae]=function(){return this},e),t)}var et=function(t){return t.type==="atomic"||t.type==="final"};function Tr(t){return Object.keys(t.states).map(function(e){return t.states[e]})}function Me(t){return Tr(t).filter(function(e){return e.type!=="history"})}function Rr(t){var e=[t];return et(t)?e:e.concat(L(Me(t).map(Rr)))}function je(t,e){var r,n,i,s,a,o,u,f,c=new Set(t),p=Pt(c),h=new Set(e);try{for(var l=b(h),d=l.next();!d.done;d=l.next())for(var v=d.value,m=v.parent;m&&!h.has(m);)h.add(m),m=m.parent}catch(N){r={error:N}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}var E=Pt(h);try{for(var g=b(h),w=g.next();!w.done;w=g.next()){var v=w.value;if(v.type==="compound"&&(!E.get(v)||!E.get(v).length))p.get(v)?p.get(v).forEach(function(T){return h.add(T)}):v.initialStateNodes.forEach(function(T){return h.add(T)});else if(v.type==="parallel")try{for(var x=(a=void 0,b(Me(v))),R=x.next();!R.done;R=x.next()){var U=R.value;h.has(U)||(h.add(U),p.get(U)?p.get(U).forEach(function(T){return h.add(T)}):U.initialStateNodes.forEach(function(T){return h.add(T)}))}}catch(T){a={error:T}}finally{try{R&&!R.done&&(o=x.return)&&o.call(x)}finally{if(a)throw a.error}}}}catch(N){i={error:N}}finally{try{w&&!w.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}try{for(var O=b(h),I=O.next();!I.done;I=O.next())for(var v=I.value,m=v.parent;m&&!h.has(m);)h.add(m),m=m.parent}catch(N){u={error:N}}finally{try{I&&!I.done&&(f=O.return)&&f.call(O)}finally{if(u)throw u.error}}return h}function br(t,e){var r=e.get(t);if(!r)return{};if(t.type==="compound"){var n=r[0];if(n){if(et(n))return n.key}else return{}}var i={};return r.forEach(function(s){i[s.key]=br(s,e)}),i}function Pt(t){var e,r,n=new Map;try{for(var i=b(t),s=i.next();!s.done;s=i.next()){var a=s.value;n.has(a)||n.set(a,[]),a.parent&&(n.has(a.parent)||n.set(a.parent,[]),n.get(a.parent).push(a))}}catch(o){e={error:o}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(e)throw e.error}}return n}function oi(t,e){var r=je([t],e);return br(t,Pt(r))}function $e(t,e){return Array.isArray(t)?t.some(function(r){return r===e}):t instanceof Set?t.has(e):!1}function ui(t){return D([],A(new Set(L(D([],A(t.map(function(e){return e.ownEvents})),!1)))),!1)}function tt(t,e){return e.type==="compound"?Me(e).some(function(r){return r.type==="final"&&$e(t,r)}):e.type==="parallel"?Me(e).every(function(r){return tt(t,r)}):!1}function ci(t){return t===void 0&&(t=[]),t.reduce(function(e,r){return r.meta!==void 0&&(e[r.id]=r.meta),e},{})}function Ar(t){return new Set(L(t.map(function(e){return e.tags})))}function Or(t,e){if(t===e)return!0;if(t===void 0||e===void 0)return!1;if(_(t)||_(e))return t===e;var r=Object.keys(t),n=Object.keys(e);return r.length===n.length&&r.every(function(i){return Or(t[i],e[i])})}function li(t){return typeof t!="object"||t===null?!1:"value"in t&&"_event"in t}function fi(t,e){var r=t.exec,n=y(y({},t),{exec:r!==void 0?function(){return r(e.context,e.event,{action:t,state:e,_event:e._event})}:void 0});return n}var Z=function(){function t(e){var r=this,n;this.actions=[],this.activities=lr,this.meta={},this.events=[],this.value=e.value,this.context=e.context,this._event=e._event,this._sessionid=e._sessionid,this.event=this._event.data,this.historyValue=e.historyValue,this.history=e.history,this.actions=e.actions||[],this.activities=e.activities||lr,this.meta=ci(e.configuration),this.events=e.events||[],this.matches=this.matches.bind(this),this.toStrings=this.toStrings.bind(this),this.configuration=e.configuration,this.transitions=e.transitions,this.children=e.children,this.done=!!e.done,this.tags=(n=Array.isArray(e.tags)?new Set(e.tags):e.tags)!==null&&n!==void 0?n:new Set,this.machine=e.machine,Object.defineProperty(this,"nextEvents",{get:function(){return ui(r.configuration)}})}return t.from=function(e,r){if(e instanceof t)return e.context!==r?new t({value:e.value,context:r,_event:e._event,_sessionid:null,historyValue:e.historyValue,history:e.history,actions:[],activities:e.activities,meta:{},events:[],configuration:[],transitions:[],children:{}}):e;var n=ge;return new t({value:e,context:r,_event:n,_sessionid:null,historyValue:void 0,history:void 0,actions:[],activities:void 0,meta:void 0,events:[],configuration:[],transitions:[],children:{}})},t.create=function(e){return new t(e)},t.inert=function(e,r){if(e instanceof t){if(!e.actions.length)return e;var n=ge;return new t({value:e.value,context:r,_event:n,_sessionid:null,historyValue:e.historyValue,history:e.history,activities:e.activities,configuration:e.configuration,transitions:[],children:{}})}return t.from(e,r)},t.prototype.toStrings=function(e,r){var n=this;if(e===void 0&&(e=this.value),r===void 0&&(r="."),_(e))return[e];var i=Object.keys(e);return i.concat.apply(i,D([],A(i.map(function(s){return n.toStrings(e[s],r).map(function(a){return s+r+a})})),!1))},t.prototype.toJSON=function(){var e=this;e.configuration,e.transitions;var r=e.tags;e.machine;var n=Et(e,["configuration","transitions","tags","machine"]);return y(y({},n),{tags:Array.from(r)})},t.prototype.matches=function(e){return At(e,this.value)},t.prototype.hasTag=function(e){return this.tags.has(e)},t.prototype.can=function(e){var r;Bn(!!this.machine);var n=(r=this.machine)===null||r===void 0?void 0:r.getTransitionData(this,e);return!!(n!=null&&n.transitions.length)&&n.transitions.some(function(i){return i.target!==void 0||i.actions.length})},t}(),di={deferEvents:!1},xr=function(){function t(e){this.processingEvent=!1,this.queue=[],this.initialized=!1,this.options=y(y({},di),e)}return t.prototype.initialize=function(e){if(this.initialized=!0,e){if(!this.options.deferEvents){this.schedule(e);return}this.process(e)}this.flushEvents()},t.prototype.schedule=function(e){if(!this.initialized||this.processingEvent){this.queue.push(e);return}if(this.queue.length!==0)throw new Error("Event queue should be empty when it is not processing events");this.process(e),this.flushEvents()},t.prototype.clear=function(){this.queue=[]},t.prototype.flushEvents=function(){for(var e=this.queue.shift();e;)this.process(e),e=this.queue.shift()},t.prototype.process=function(e){this.processingEvent=!0;try{e()}catch(r){throw this.clear(),r}finally{this.processingEvent=!1}},t}(),Ct=new Map,hi=0,rt={bookId:function(){return"x:".concat(hi++)},register:function(t,e){return Ct.set(t,e),t},get:function(t){return Ct.get(t)},free:function(t){Ct.delete(t)}};function Dt(){if(typeof globalThis!="undefined")return globalThis;if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof global!="undefined")return global}function vi(){var t=Dt();if(t&&"__xstate__"in t)return t.__xstate__}function pi(t){if(!!Dt()){var e=vi();e&&e.register(t)}}function mi(t,e){e===void 0&&(e={});var r=t.initialState,n=new Set,i=[],s=!1,a=function(){if(!s){for(s=!0;i.length>0;){var f=i.shift();r=t.transition(r,f,u),n.forEach(function(c){return c.next(r)})}s=!1}},o=ai({id:e.id,send:function(f){i.push(f),a()},getSnapshot:function(){return r},subscribe:function(f,c,p){var h=Ye(f,c,p);return n.add(h),h.next(r),{unsubscribe:function(){n.delete(h)}}}}),u={parent:e.parent,self:o,id:e.id||"anonymous",observers:n};return r=t.start?t.start(u):r,o}var yi={sync:!1,autoForward:!1},F;(function(t){t[t.NotStarted=0]="NotStarted",t[t.Running=1]="Running",t[t.Stopped=2]="Stopped"})(F||(F={}));var gi=function(){function t(e,r){r===void 0&&(r=t.defaultOptions);var n=this;this.machine=e,this.delayedEventsMap={},this.listeners=new Set,this.contextListeners=new Set,this.stopListeners=new Set,this.doneListeners=new Set,this.eventListeners=new Set,this.sendListeners=new Set,this.initialized=!1,this.status=F.NotStarted,this.children=new Map,this.forwardTo=new Set,this._outgoingQueue=[],this.init=this.start,this.send=function(c,p){if(pe(c))return n.batch(c),n.state;var h=$(xt(c,p));if(n.status===F.Stopped)return n.state;if(n.status!==F.Running&&!n.options.deferEvents)throw new Error('Event "'.concat(h.name,'" was sent to uninitialized service "').concat(n.machine.id,`". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.
Event: `).concat(JSON.stringify(h.data)));return n.scheduler.schedule(function(){n.forward(h);var l=n._nextState(h);n.update(l,h)}),n._state},this.sendTo=function(c,p,h){var l=n.parent&&(p===se.Parent||n.parent.id===p),d=l?n.parent:_(p)?n.children.get(p)||rt.get(p):Kn(p)?p:void 0;if(!d){if(!l)throw new Error("Unable to send event to child '".concat(p,"' from service '").concat(n.id,"'."));return}if("machine"in d){if(n.status!==F.Stopped||n.parent!==d||n.state.done){var v=y(y({},c),{name:c.name===Nn?"".concat(Le(n.id)):c.name,origin:n.sessionId});!h&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([d,v]):d.send(v)}}else!h&&n.machine.config.predictableActionArguments?n._outgoingQueue.push([d,c.data]):d.send(c.data)},this._exec=function(c,p,h,l){l===void 0&&(l=n.machine.options.actions);var d=c.exec||It(c.type,l),v=C(d)?d:d?d.exec:c.exec;if(v)try{return v(p,h.data,n.machine.config.predictableActionArguments?{action:c,_event:h}:{action:c,state:n.state,_event:h})}catch(H){throw n.parent&&n.parent.send({type:"xstate.error",data:H}),H}switch(c.type){case ve:var m=c;if(typeof m.delay=="number"){n.defer(m);return}else m.to?n.sendTo(m._event,m.to,h===ge):n.send(m._event);break;case sr:n.cancel(c.sendId);break;case wt:{if(n.status!==F.Running)return;var E=c.activity;if(!n.machine.config.predictableActionArguments&&!n.state.activities[E.id||E.type])break;if(E.type===P.Invoke){var g=Er(E.src),w=n.machine.options.services?n.machine.options.services[g.type]:void 0,x=E.id,R=E.data,U="autoForward"in E?E.autoForward:!!E.forward;if(!w)return;var O=R?ze(R,p,h):void 0;if(typeof w=="string")return;var I=C(w)?w(p,h.data,{data:O,src:g,meta:E.meta}):w;if(!I)return;var N=void 0;me(I)&&(I=O?I.withContext(O):I,N={autoForward:U}),n.spawn(I,x,N)}else n.spawnActivity(E);break}case St:{n.stopChild(c.activity.id);break}case ar:var T=c.label,k=c.value;T?n.logger(T,k):n.logger(k);break}};var i=y(y({},t.defaultOptions),r),s=i.clock,a=i.logger,o=i.parent,u=i.id,f=u!==void 0?u:e.id;this.id=f,this.logger=a,this.clock=s,this.parent=o,this.options=i,this.scheduler=new xr({deferEvents:this.options.deferEvents}),this.sessionId=rt.bookId()}return Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this;return this._initialState?this._initialState:Ee(this,function(){return e._initialState=e.machine.initialState,e._initialState})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._state},enumerable:!1,configurable:!0}),t.prototype.execute=function(e,r){var n,i;try{for(var s=b(e.actions),a=s.next();!a.done;a=s.next()){var o=a.value;this.exec(o,e,r)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.update=function(e,r){var n,i,s,a,o,u,f,c,p=this;if(e._sessionid=this.sessionId,this._state=e,(!this.machine.config.predictableActionArguments||r===ge)&&this.options.execute)this.execute(this.state);else for(var h=void 0;h=this._outgoingQueue.shift();)h[0].send(h[1]);if(this.children.forEach(function(N){p.state.children[N.id]=N}),this.devTools&&this.devTools.send(r.data,e),e.event)try{for(var l=b(this.eventListeners),d=l.next();!d.done;d=l.next()){var v=d.value;v(e.event)}}catch(N){n={error:N}}finally{try{d&&!d.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}try{for(var m=b(this.listeners),E=m.next();!E.done;E=m.next()){var v=E.value;v(e,e.event)}}catch(N){s={error:N}}finally{try{E&&!E.done&&(a=m.return)&&a.call(m)}finally{if(s)throw s.error}}try{for(var g=b(this.contextListeners),w=g.next();!w.done;w=g.next()){var x=w.value;x(this.state.context,this.state.history?this.state.history.context:void 0)}}catch(N){o={error:N}}finally{try{w&&!w.done&&(u=g.return)&&u.call(g)}finally{if(o)throw o.error}}if(this.state.done){var R=e.configuration.find(function(N){return N.type==="final"&&N.parent===p.machine}),U=R&&R.doneData?ze(R.doneData,e.context,r):void 0;try{for(var O=b(this.doneListeners),I=O.next();!I.done;I=O.next()){var v=I.value;v(Xe(this.id,U))}}catch(N){f={error:N}}finally{try{I&&!I.done&&(c=O.return)&&c.call(O)}finally{if(f)throw f.error}}this._stop(),this._stopChildren()}},t.prototype.onTransition=function(e){return this.listeners.add(e),this.status===F.Running&&e(this.state,this.state.event),this},t.prototype.subscribe=function(e,r,n){var i=this,s=Ye(e,r,n);this.listeners.add(s.next),this.status!==F.NotStarted&&s.next(this.state);var a=function(){i.doneListeners.delete(a),i.stopListeners.delete(a),s.complete()};return this.status===F.Stopped?s.complete():(this.onDone(a),this.onStop(a)),{unsubscribe:function(){i.listeners.delete(s.next),i.doneListeners.delete(a),i.stopListeners.delete(a)}}},t.prototype.onEvent=function(e){return this.eventListeners.add(e),this},t.prototype.onSend=function(e){return this.sendListeners.add(e),this},t.prototype.onChange=function(e){return this.contextListeners.add(e),this},t.prototype.onStop=function(e){return this.stopListeners.add(e),this},t.prototype.onDone=function(e){return this.doneListeners.add(e),this},t.prototype.off=function(e){return this.listeners.delete(e),this.eventListeners.delete(e),this.sendListeners.delete(e),this.stopListeners.delete(e),this.doneListeners.delete(e),this.contextListeners.delete(e),this},t.prototype.start=function(e){var r=this;if(this.status===F.Running)return this;this.machine._init(),rt.register(this.sessionId,this),this.initialized=!0,this.status=F.Running;var n=e===void 0?this.initialState:Ee(this,function(){return li(e)?r.machine.resolveState(e):r.machine.resolveState(Z.from(e,r.machine.context))});return this.options.devTools&&this.attachDev(),this.scheduler.initialize(function(){r.update(n,ge)}),this},t.prototype._stopChildren=function(){this.children.forEach(function(e){C(e.stop)&&e.stop()}),this.children.clear()},t.prototype._stop=function(){var e,r,n,i,s,a,o,u,f,c;try{for(var p=b(this.listeners),h=p.next();!h.done;h=p.next()){var l=h.value;this.listeners.delete(l)}}catch(O){e={error:O}}finally{try{h&&!h.done&&(r=p.return)&&r.call(p)}finally{if(e)throw e.error}}try{for(var d=b(this.stopListeners),v=d.next();!v.done;v=d.next()){var l=v.value;l(),this.stopListeners.delete(l)}}catch(O){n={error:O}}finally{try{v&&!v.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}try{for(var m=b(this.contextListeners),E=m.next();!E.done;E=m.next()){var l=E.value;this.contextListeners.delete(l)}}catch(O){s={error:O}}finally{try{E&&!E.done&&(a=m.return)&&a.call(m)}finally{if(s)throw s.error}}try{for(var g=b(this.doneListeners),w=g.next();!w.done;w=g.next()){var l=w.value;this.doneListeners.delete(l)}}catch(O){o={error:O}}finally{try{w&&!w.done&&(u=g.return)&&u.call(g)}finally{if(o)throw o.error}}if(!this.initialized)return this;this.initialized=!1,this.status=F.Stopped,this._initialState=void 0;try{for(var x=b(Object.keys(this.delayedEventsMap)),R=x.next();!R.done;R=x.next()){var U=R.value;this.clock.clearTimeout(this.delayedEventsMap[U])}}catch(O){f={error:O}}finally{try{R&&!R.done&&(c=x.return)&&c.call(x)}finally{if(f)throw f.error}}this.scheduler.clear(),this.scheduler=new xr({deferEvents:this.options.deferEvents})},t.prototype.stop=function(){var e=this,r=this.scheduler;return this._stop(),r.schedule(function(){var n=$({type:"xstate.stop"}),i=Ee(e,function(){var s=L(D([],A(e.state.configuration),!1).sort(function(c,p){return p.order-c.order}).map(function(c){return oe(c.onExit,e.machine.options.actions)})),a=A(Ze(e.machine,e.state,e.state.context,n,[s],e.machine.config.predictableActionArguments?e._exec:void 0,e.machine.config.predictableActionArguments||e.machine.config.preserveActionOrder),2),o=a[0],u=a[1],f=new Z({value:e.state.value,context:u,_event:n,_sessionid:e.sessionId,historyValue:void 0,history:e.state,actions:o.filter(function(c){return c.type!==he&&(c.type!==ve||!!c.to&&c.to!==se.Internal)}),activities:{},events:[],configuration:[],transitions:[],children:{},done:e.state.done,tags:e.state.tags,machine:e.machine});return f.changed=!0,f});e.update(i,n),e._stopChildren(),rt.free(e.sessionId)}),this},t.prototype.batch=function(e){var r=this;if(!(this.status===F.NotStarted&&this.options.deferEvents)){if(this.status!==F.Running)throw new Error("".concat(e.length,' event(s) were sent to uninitialized service "').concat(this.machine.id,'". Make sure .start() is called for this service, or set { deferEvents: true } in the service options.'))}if(!!e.length){var n=!!this.machine.config.predictableActionArguments&&this._exec;this.scheduler.schedule(function(){var i,s,a=r.state,o=!1,u=[],f=function(l){var d=$(l);r.forward(d),a=Ee(r,function(){return r.machine.transition(a,d,void 0,n||void 0)}),u.push.apply(u,D([],A(r.machine.config.predictableActionArguments?a.actions:a.actions.map(function(v){return fi(v,a)})),!1)),o=o||!!a.changed};try{for(var c=b(e),p=c.next();!p.done;p=c.next()){var h=p.value;f(h)}}catch(l){i={error:l}}finally{try{p&&!p.done&&(s=c.return)&&s.call(c)}finally{if(i)throw i.error}}a.changed=o,a.actions=u,r.update(a,$(e[e.length-1]))})}},t.prototype.sender=function(e){return this.send.bind(this,e)},t.prototype._nextState=function(e,r){var n=this;r===void 0&&(r=!!this.machine.config.predictableActionArguments&&this._exec);var i=$(e);if(i.name.indexOf(or)===0&&!this.state.nextEvents.some(function(a){return a.indexOf(or)===0}))throw i.data.data;var s=Ee(this,function(){return n.machine.transition(n.state,i,void 0,r||void 0)});return s},t.prototype.nextState=function(e){return this._nextState(e,!1)},t.prototype.forward=function(e){var r,n;try{for(var i=b(this.forwardTo),s=i.next();!s.done;s=i.next()){var a=s.value,o=this.children.get(a);if(!o)throw new Error("Unable to forward event '".concat(e,"' from interpreter '").concat(this.id,"' to nonexistant child '").concat(a,"'."));o.send(e)}}catch(u){r={error:u}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}},t.prototype.defer=function(e){var r=this;this.delayedEventsMap[e.id]=this.clock.setTimeout(function(){e.to?r.sendTo(e._event,e.to,!0):r.send(e._event)},e.delay)},t.prototype.cancel=function(e){this.clock.clearTimeout(this.delayedEventsMap[e]),delete this.delayedEventsMap[e]},t.prototype.exec=function(e,r,n){n===void 0&&(n=this.machine.options.actions),this._exec(e,r.context,r._event,n)},t.prototype.removeChild=function(e){var r;this.children.delete(e),this.forwardTo.delete(e),(r=this.state)===null||r===void 0||delete r.children[e]},t.prototype.stopChild=function(e){var r=this.children.get(e);!r||(this.removeChild(e),C(r.stop)&&r.stop())},t.prototype.spawn=function(e,r,n){if(this.status!==F.Running)return Sr(e,r);if(vr(e))return this.spawnPromise(Promise.resolve(e),r);if(C(e))return this.spawnCallback(e,r);if(si(e))return this.spawnActor(e,r);if(qn(e))return this.spawnObservable(e,r);if(me(e))return this.spawnMachine(e,y(y({},n),{id:r}));if($n(e))return this.spawnBehavior(e,r);throw new Error('Unable to spawn entity "'.concat(r,'" of type "').concat(typeof e,'".'))},t.prototype.spawnMachine=function(e,r){var n=this;r===void 0&&(r={});var i=new t(e,y(y({},this.options),{parent:this,id:r.id||e.id})),s=y(y({},yi),r);s.sync&&i.onTransition(function(o){n.send(ur,{state:o,id:i.id})});var a=i;return this.children.set(i.id,a),s.autoForward&&this.forwardTo.add(i.id),i.onDone(function(o){n.removeChild(i.id),n.send($(o,{origin:i.id}))}).start(),a},t.prototype.spawnBehavior=function(e,r){var n=mi(e,{id:r,parent:this});return this.children.set(r,n),n},t.prototype.spawnPromise=function(e,r){var n,i=this,s=!1,a;e.then(function(u){s||(a=u,i.removeChild(r),i.send($(Xe(r,u),{origin:r})))},function(u){if(!s){i.removeChild(r);var f=Le(r,u);try{i.send($(f,{origin:r}))}catch{i.devTools&&i.devTools.send(f,i.state),i.machine.strict&&i.stop()}}});var o=(n={id:r,send:function(){},subscribe:function(u,f,c){var p=Ye(u,f,c),h=!1;return e.then(function(l){h||(p.next(l),!h&&p.complete())},function(l){h||p.error(l)}),{unsubscribe:function(){return h=!0}}},stop:function(){s=!0},toJSON:function(){return{id:r}},getSnapshot:function(){return a}},n[ae]=function(){return this},n);return this.children.set(r,o),o},t.prototype.spawnCallback=function(e,r){var n,i=this,s=!1,a=new Set,o=new Set,u,f=function(h){u=h,o.forEach(function(l){return l(h)}),!s&&i.send($(h,{origin:r}))},c;try{c=e(f,function(h){a.add(h)})}catch(h){this.send(Le(r,h))}if(vr(c))return this.spawnPromise(c,r);var p=(n={id:r,send:function(h){return a.forEach(function(l){return l(h)})},subscribe:function(h){var l=Ye(h);return o.add(l.next),{unsubscribe:function(){o.delete(l.next)}}},stop:function(){s=!0,C(c)&&c()},toJSON:function(){return{id:r}},getSnapshot:function(){return u}},n[ae]=function(){return this},n);return this.children.set(r,p),p},t.prototype.spawnObservable=function(e,r){var n,i=this,s,a=e.subscribe(function(u){s=u,i.send($(u,{origin:r}))},function(u){i.removeChild(r),i.send($(Le(r,u),{origin:r}))},function(){i.removeChild(r),i.send($(Xe(r),{origin:r}))}),o=(n={id:r,send:function(){},subscribe:function(u,f,c){return e.subscribe(u,f,c)},stop:function(){return a.unsubscribe()},getSnapshot:function(){return s},toJSON:function(){return{id:r}}},n[ae]=function(){return this},n);return this.children.set(r,o),o},t.prototype.spawnActor=function(e,r){return this.children.set(r,e),e},t.prototype.spawnActivity=function(e){var r=this.machine.options&&this.machine.options.activities?this.machine.options.activities[e.type]:void 0;if(!!r){var n=r(this.state.context,e);this.spawnEffect(e.id,n)}},t.prototype.spawnEffect=function(e,r){var n;this.children.set(e,(n={id:e,send:function(){},subscribe:function(){return{unsubscribe:function(){}}},stop:r||void 0,getSnapshot:function(){},toJSON:function(){return{id:e}}},n[ae]=function(){return this},n))},t.prototype.attachDev=function(){var e=Dt();if(this.options.devTools&&e){if(e.__REDUX_DEVTOOLS_EXTENSION__){var r=typeof this.options.devTools=="object"?this.options.devTools:void 0;this.devTools=e.__REDUX_DEVTOOLS_EXTENSION__.connect(y(y({name:this.id,autoPause:!0,stateSanitizer:function(n){return{value:n.value,context:n.context,actions:n.actions}}},r),{features:y({jump:!1,skip:!1},r?r.features:void 0)}),this.machine),this.devTools.init(this.state)}pi(this)}},t.prototype.toJSON=function(){return{id:this.id}},t.prototype[ae]=function(){return this},t.prototype.getSnapshot=function(){return this.status===F.NotStarted?this.initialState:this._state},t.defaultOptions={execute:!0,deferEvents:!0,clock:{setTimeout:function(e,r){return setTimeout(e,r)},clearTimeout:function(e){return clearTimeout(e)}},logger:console.log.bind(console),devTools:!1},t.interpret=Ir,t}();function Ir(t,e){var r=new gi(t,e);return r}function Ei(t){if(typeof t=="string"){var e={type:t};return e.toString=function(){return t},e}return t}function nt(t){return y(y({type:Rt},t),{toJSON:function(){t.onDone,t.onError;var e=Et(t,["onDone","onError"]);return y(y({},e),{type:Rt,src:Ei(t.src)})}})}var it="",kt="#",Ut="*",we={},Se=function(t){return t[0]===kt},wi=function(){return{actions:{},guards:{},services:{},activities:{},delays:{}}},Si=function(){function t(e,r,n,i){n===void 0&&(n="context"in e?e.context:void 0);var s=this,a;this.config=e,this._context=n,this.order=-1,this.__xstatenode=!0,this.__cache={events:void 0,relativeValue:new Map,initialStateValue:void 0,initialState:void 0,on:void 0,transitions:void 0,candidates:{},delayedTransitions:void 0},this.idMap={},this.tags=[],this.options=Object.assign(wi(),r),this.parent=i==null?void 0:i.parent,this.key=this.config.key||(i==null?void 0:i.key)||this.config.id||"(machine)",this.machine=this.parent?this.parent.machine:this,this.path=this.parent?this.parent.path.concat(this.key):[],this.delimiter=this.config.delimiter||(this.parent?this.parent.delimiter:cr),this.id=this.config.id||D([this.machine.key],A(this.path),!1).join(this.delimiter),this.version=this.parent?this.parent.version:this.config.version,this.type=this.config.type||(this.config.parallel?"parallel":this.config.states&&Object.keys(this.config.states).length?"compound":this.config.history?"history":"atomic"),this.schema=this.parent?this.machine.schema:(a=this.config.schema)!==null&&a!==void 0?a:{},this.description=this.config.description,this.initial=this.config.initial,this.states=this.config.states?ke(this.config.states,function(f,c){var p,h=new t(f,{},void 0,{parent:s,key:c});return Object.assign(s.idMap,y((p={},p[h.id]=h,p),h.idMap)),h}):we;var o=0;function u(f){var c,p;f.order=o++;try{for(var h=b(Tr(f)),l=h.next();!l.done;l=h.next()){var d=l.value;u(d)}}catch(v){c={error:v}}finally{try{l&&!l.done&&(p=h.return)&&p.call(h)}finally{if(c)throw c.error}}}u(this),this.history=this.config.history===!0?"shallow":this.config.history||!1,this._transient=!!this.config.always||(this.config.on?Array.isArray(this.config.on)?this.config.on.some(function(f){var c=f.event;return c===it}):it in this.config.on:!1),this.strict=!!this.config.strict,this.onEntry=z(this.config.entry||this.config.onEntry).map(function(f){return Ue(f)}),this.onExit=z(this.config.exit||this.config.onExit).map(function(f){return Ue(f)}),this.meta=this.config.meta,this.doneData=this.type==="final"?this.config.data:void 0,this.invoke=z(this.config.invoke).map(function(f,c){var p,h;if(me(f)){var l=Je(s.id,c);return s.machine.options.services=y((p={},p[l]=f,p),s.machine.options.services),nt({src:l,id:l})}else if(_(f.src)){var l=f.id||Je(s.id,c);return nt(y(y({},f),{id:l,src:f.src}))}else if(me(f.src)||C(f.src)){var l=f.id||Je(s.id,c);return s.machine.options.services=y((h={},h[l]=f.src,h),s.machine.options.services),nt(y(y({id:l},f),{src:l}))}else{var d=f.src;return nt(y(y({id:Je(s.id,c)},f),{src:d}))}}),this.activities=z(this.config.activities).concat(this.invoke).map(function(f){return _t(f)}),this.transition=this.transition.bind(this),this.tags=z(this.config.tags)}return t.prototype._init=function(){this.__cache.transitions||Rr(this).forEach(function(e){return e.on})},t.prototype.withConfig=function(e,r){var n=this.options,i=n.actions,s=n.activities,a=n.guards,o=n.services,u=n.delays;return new t(this.config,{actions:y(y({},i),e.actions),activities:y(y({},s),e.activities),guards:y(y({},a),e.guards),services:y(y({},o),e.services),delays:y(y({},u),e.delays)},r!=null?r:this.context)},t.prototype.withContext=function(e){return new t(this.config,this.options,e)},Object.defineProperty(t.prototype,"context",{get:function(){return C(this._context)?this._context():this._context},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"definition",{get:function(){return{id:this.id,key:this.key,version:this.version,context:this.context,type:this.type,initial:this.initial,history:this.history,states:ke(this.states,function(e){return e.definition}),on:this.on,transitions:this.transitions,entry:this.onEntry,exit:this.onExit,activities:this.activities||[],meta:this.meta,order:this.order||-1,data:this.doneData,invoke:this.invoke,description:this.description,tags:this.tags}},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return this.definition},Object.defineProperty(t.prototype,"on",{get:function(){if(this.__cache.on)return this.__cache.on;var e=this.transitions;return this.__cache.on=e.reduce(function(r,n){return r[n.eventType]=r[n.eventType]||[],r[n.eventType].push(n),r},{})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"after",{get:function(){return this.__cache.delayedTransitions||(this.__cache.delayedTransitions=this.getDelayedTransitions(),this.__cache.delayedTransitions)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"transitions",{get:function(){return this.__cache.transitions||(this.__cache.transitions=this.formatTransitions(),this.__cache.transitions)},enumerable:!1,configurable:!0}),t.prototype.getCandidates=function(e){if(this.__cache.candidates[e])return this.__cache.candidates[e];var r=e===it,n=this.transitions.filter(function(i){var s=i.eventType===e;return r?s:s||i.eventType===Ut});return this.__cache.candidates[e]=n,n},t.prototype.getDelayedTransitions=function(){var e=this,r=this.config.after;if(!r)return[];var n=function(s,a){var o=C(s)?"".concat(e.id,":delay[").concat(a,"]"):s,u=ti(o,e.id);return e.onEntry.push(Nt(u,{delay:s})),e.onExit.push(Jn(u)),u},i=pe(r)?r.map(function(s,a){var o=n(s.delay,a);return y(y({},s),{event:o})}):L(Object.keys(r).map(function(s,a){var o=r[s],u=_(o)?{target:o}:o,f=isNaN(+s)?s:+s,c=n(f,a);return z(u).map(function(p){return y(y({},p),{event:c,delay:f})})}));return i.map(function(s){var a=s.delay;return y(y({},e.formatTransition(s)),{delay:a})})},t.prototype.getStateNodes=function(e){var r,n=this;if(!e)return[];var i=e instanceof Z?e.value:De(e,this.delimiter);if(_(i)){var s=this.getStateNode(i).initial;return s!==void 0?this.getStateNodes((r={},r[i]=s,r)):[this,this.states[i]]}var a=Object.keys(i),o=[this];return o.push.apply(o,D([],A(L(a.map(function(u){return n.getStateNode(u).getStateNodes(i[u])}))),!1)),o},t.prototype.handles=function(e){var r=fr(e);return this.events.includes(r)},t.prototype.resolveState=function(e){var r=e instanceof Z?e:Z.create(e),n=Array.from(je([],this.getStateNodes(r.value)));return new Z(y(y({},r),{value:this.resolve(r.value),configuration:n,done:tt(n,this),tags:Ar(n),machine:this.machine}))},t.prototype.transitionLeafNode=function(e,r,n){var i=this.getStateNode(e),s=i.next(r,n);return!s||!s.transitions.length?this.next(r,n):s},t.prototype.transitionCompoundNode=function(e,r,n){var i=Object.keys(e),s=this.getStateNode(i[0]),a=s._transition(e[i[0]],r,n);return!a||!a.transitions.length?this.next(r,n):a},t.prototype.transitionParallelNode=function(e,r,n){var i,s,a={};try{for(var o=b(Object.keys(e)),u=o.next();!u.done;u=o.next()){var f=u.value,c=e[f];if(!!c){var p=this.getStateNode(f),h=p._transition(c,r,n);h&&(a[f]=h)}}}catch(g){i={error:g}}finally{try{u&&!u.done&&(s=o.return)&&s.call(o)}finally{if(i)throw i.error}}var l=Object.keys(a).map(function(g){return a[g]}),d=L(l.map(function(g){return g.transitions})),v=l.some(function(g){return g.transitions.length>0});if(!v)return this.next(r,n);var m=L(l.map(function(g){return g.entrySet})),E=L(Object.keys(a).map(function(g){return a[g].configuration}));return{transitions:d,entrySet:m,exitSet:L(l.map(function(g){return g.exitSet})),configuration:E,source:r,actions:L(Object.keys(a).map(function(g){return a[g].actions}))}},t.prototype._transition=function(e,r,n){return _(e)?this.transitionLeafNode(e,r,n):Object.keys(e).length===1?this.transitionCompoundNode(e,r,n):this.transitionParallelNode(e,r,n)},t.prototype.getTransitionData=function(e,r){return this._transition(e.value,e,$(r))},t.prototype.next=function(e,r){var n,i,s=this,a=r.name,o=[],u=[],f;try{for(var c=b(this.getCandidates(a)),p=c.next();!p.done;p=c.next()){var h=p.value,l=h.cond,d=h.in,v=e.context,m=d?_(d)&&Se(d)?e.matches(De(this.getStateNodeById(d).path,this.delimiter)):At(De(d,this.delimiter),Ln(this.path.slice(0,-2))(e.value)):!0,E=!1;try{E=!l||gr(this.machine,l,v,r,e)}catch(R){throw new Error("Unable to evaluate guard '".concat(l.name||l.type,"' in transition for event '").concat(a,"' in state node '").concat(this.id,`':
`).concat(R.message))}if(E&&m){h.target!==void 0&&(u=h.target),o.push.apply(o,D([],A(h.actions),!1)),f=h;break}}}catch(R){n={error:R}}finally{try{p&&!p.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}if(!!f){if(!u.length)return{transitions:[f],entrySet:[],exitSet:[],configuration:e.value?[this]:[],source:e,actions:o};var g=L(u.map(function(R){return s.getRelativeStateNodes(R,e.historyValue)})),w=!!f.internal,x=[];return w||u.forEach(function(R){x.push.apply(x,D([],A(s.getExternalReentryNodes(R)),!1))}),{transitions:[f],entrySet:x,exitSet:w?[]:[this],configuration:g,source:e,actions:o}}},t.prototype.getExternalReentryNodes=function(e){for(var r=[],n=A(e.order>this.order?[e,this]:[this,e],2),i=n[0],s=n[1];i&&i!==s;)r.push(i),i=i.parent;return i!==s?[]:(r.push(s),r)},t.prototype.getActions=function(e,r,n,i,s,a,o){var u,f,c,p,h=this,l=je([],a?this.getStateNodes(a.value):[this]);try{for(var d=b(e),v=d.next();!v.done;v=d.next()){var m=v.value;(!$e(l,m)||$e(n.entrySet,m.parent))&&n.entrySet.push(m)}}catch(T){u={error:T}}finally{try{v&&!v.done&&(f=d.return)&&f.call(d)}finally{if(u)throw u.error}}try{for(var E=b(l),g=E.next();!g.done;g=E.next()){var m=g.value;(!$e(e,m)||$e(n.exitSet,m.parent))&&n.exitSet.push(m)}}catch(T){c={error:T}}finally{try{g&&!g.done&&(p=E.return)&&p.call(E)}finally{if(c)throw c.error}}var w=L(n.entrySet.map(function(T){var k=[];if(T.type!=="final")return k;var H=T.parent;if(!H.parent)return k;k.push(Qe(T.id,T.doneData),Qe(H.id,T.doneData?ze(T.doneData,i,s):void 0));var Q=H.parent;return Q.type==="parallel"&&Me(Q).every(function(ie){return tt(n.configuration,ie)})&&k.push(Qe(Q.id)),k}));n.exitSet.sort(function(T,k){return k.order-T.order}),n.entrySet.sort(function(T,k){return T.order-k.order});var x=new Set(n.entrySet),R=new Set(n.exitSet),U=Array.from(x).map(function(T){var k=T.onEntry,H=T.activities.map(function(Q){return Qn(Q)});return oe(o?D(D([],A(k),!1),A(H),!1):D(D([],A(H),!1),A(k),!1),h.machine.options.actions)}).concat([w.map(Hn)]),O=Array.from(R).map(function(T){return oe(D(D([],A(T.onExit),!1),A(T.activities.map(function(k){return Xn(k)})),!1),h.machine.options.actions)}),I=O.concat([oe(n.actions,this.machine.options.actions)]).concat(U);if(r){var N=oe(L(D([],A(e),!1).sort(function(T,k){return k.order-T.order}).map(function(T){return T.onExit})),this.machine.options.actions).filter(function(T){return T.type!==he&&(T.type!==ve||!!T.to&&T.to!==se.Internal)});return I.concat([N])}return I},t.prototype.transition=function(e,r,n,i){e===void 0&&(e=this.initialState);var s=$(r),a;if(e instanceof Z)a=n===void 0?e:this.resolveState(Z.from(e,n));else{var o=_(e)?this.resolve(He(this.getResolvedPath(e))):this.resolve(e),u=n!=null?n:this.machine.context;a=this.resolveState(Z.from(o,u))}if(this.strict&&!this.events.includes(s.name)&&!jn(s.name))throw new Error("Machine '".concat(this.id,"' does not accept event '").concat(s.name,"'"));var f=this._transition(a.value,a,s)||{transitions:[],configuration:[],entrySet:[],exitSet:[],source:a,actions:[]},c=je([],this.getStateNodes(a.value)),p=f.configuration.length?je(c,f.configuration):c;return f.configuration=D([],A(p),!1),this.resolveTransition(f,a,a.context,i,s)},t.prototype.resolveRaisedTransition=function(e,r,n,i){var s,a=e.actions;return e=this.transition(e,r,void 0,i),e._event=n,e.event=n.data,(s=e.actions).unshift.apply(s,D([],A(a),!1)),e},t.prototype.resolveTransition=function(e,r,n,i,s){var a,o,u,f,c=this;s===void 0&&(s=ge);var p=e.configuration,h=!r||e.transitions.length>0,l=h?e.configuration:r?r.configuration:[],d=tt(l,this),v=h?oi(this.machine,p):void 0,m=r?r.historyValue?r.historyValue:e.source?this.machine.historyValue(r.value):void 0:void 0,E=this.getActions(new Set(l),d,e,n,s,r,i),g=r?y({},r.activities):{};try{for(var w=b(E),x=w.next();!x.done;x=w.next()){var R=x.value;try{for(var U=(u=void 0,b(R)),O=U.next();!O.done;O=U.next()){var I=O.value;I.type===wt?g[I.activity.id||I.activity.type]=I:I.type===St&&(g[I.activity.id||I.activity.type]=!1)}}catch(K){u={error:K}}finally{try{O&&!O.done&&(f=U.return)&&f.call(U)}finally{if(u)throw u.error}}}}catch(K){a={error:K}}finally{try{x&&!x.done&&(o=w.return)&&o.call(w)}finally{if(a)throw a.error}}var N=A(Ze(this,r,n,s,E,i,this.machine.config.predictableActionArguments||this.machine.config.preserveActionOrder),2),T=N[0],k=N[1],H=A(Fn(T,function(K){return K.type===he||K.type===ve&&K.to===se.Internal}),2),Q=H[0],ie=H[1],Ne=T.filter(function(K){var Ce;return K.type===wt&&((Ce=K.activity)===null||Ce===void 0?void 0:Ce.type)===Rt}),Ia=Ne.reduce(function(K,Ce){return K[Ce.activity.id]=ni(Ce.activity,c.machine,k,s),K},r?y({},r.children):{}),gt=new Z({value:v||r.value,context:k,_event:s,_sessionid:r?r._sessionid:null,historyValue:v?m?Vn(m,v):void 0:r?r.historyValue:void 0,history:!v||e.source?r:void 0,actions:v?ie:[],activities:v?g:r?r.activities:{},events:[],configuration:l,transitions:e.transitions,children:Ia,done:d,tags:Ar(l),machine:this}),On=n!==k;gt.changed=s.name===ur||On;var Pe=gt.history;Pe&&delete Pe.history;var xn=!d&&(this._transient||p.some(function(K){return K._transient}));if(!h&&(!xn||s.name===it))return gt;var X=gt;if(!d)for(xn&&(X=this.resolveRaisedTransition(X,{type:In},s,i));Q.length;){var _a=Q.shift();X=this.resolveRaisedTransition(X,_a._event,s,i)}var Na=X.changed||(Pe?!!X.actions.length||On||typeof Pe.value!=typeof X.value||!Or(X.value,Pe.value):void 0);return X.changed=Na,X.history=Pe,X},t.prototype.getStateNode=function(e){if(Se(e))return this.machine.getStateNodeById(e);if(!this.states)throw new Error("Unable to retrieve child state '".concat(e,"' from '").concat(this.id,"'; no child states exist."));var r=this.states[e];if(!r)throw new Error("Child state '".concat(e,"' does not exist on '").concat(this.id,"'"));return r},t.prototype.getStateNodeById=function(e){var r=Se(e)?e.slice(kt.length):e;if(r===this.id)return this;var n=this.machine.idMap[r];if(!n)throw new Error("Child state node '#".concat(r,"' does not exist on machine '").concat(this.id,"'"));return n},t.prototype.getStateNodeByPath=function(e){if(typeof e=="string"&&Se(e))try{return this.getStateNodeById(e.slice(1))}catch{}for(var r=Ot(e,this.delimiter).slice(),n=this;r.length;){var i=r.shift();if(!i.length)break;n=n.getStateNode(i)}return n},t.prototype.resolve=function(e){var r,n=this;if(!e)return this.initialStateValue||we;switch(this.type){case"parallel":return ke(this.initialStateValue,function(s,a){return s?n.getStateNode(a).resolve(e[a]||s):we});case"compound":if(_(e)){var i=this.getStateNode(e);return i.type==="parallel"||i.type==="compound"?(r={},r[e]=i.initialStateValue,r):e}return Object.keys(e).length?ke(e,function(s,a){return s?n.getStateNode(a).resolve(s):we}):this.initialStateValue||{};default:return e||we}},t.prototype.getResolvedPath=function(e){if(Se(e)){var r=this.machine.idMap[e.slice(kt.length)];if(!r)throw new Error("Unable to find state node '".concat(e,"'"));return r.path}return Ot(e,this.delimiter)},Object.defineProperty(t.prototype,"initialStateValue",{get:function(){var e;if(this.__cache.initialStateValue)return this.__cache.initialStateValue;var r;if(this.type==="parallel")r=dr(this.states,function(n){return n.initialStateValue||we},function(n){return n.type!=="history"});else if(this.initial!==void 0){if(!this.states[this.initial])throw new Error("Initial state '".concat(this.initial,"' not found on '").concat(this.key,"'"));r=et(this.states[this.initial])?this.initial:(e={},e[this.initial]=this.states[this.initial].initialStateValue,e)}else r={};return this.__cache.initialStateValue=r,this.__cache.initialStateValue},enumerable:!1,configurable:!0}),t.prototype.getInitialState=function(e,r){this._init();var n=this.getStateNodes(e);return this.resolveTransition({configuration:n,entrySet:D([],A(n),!1),exitSet:[],transitions:[],source:void 0,actions:[]},void 0,r!=null?r:this.machine.context,void 0)},Object.defineProperty(t.prototype,"initialState",{get:function(){var e=this.initialStateValue;if(!e)throw new Error("Cannot retrieve initial state from simple state '".concat(this.id,"'."));return this.getInitialState(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"target",{get:function(){var e;if(this.type==="history"){var r=this.config;_(r.target)?e=Se(r.target)?He(this.machine.getStateNodeById(r.target).path.slice(this.path.length-1)):r.target:e=r.target}return e},enumerable:!1,configurable:!0}),t.prototype.getRelativeStateNodes=function(e,r,n){return n===void 0&&(n=!0),n?e.type==="history"?e.resolveHistory(r):e.initialStateNodes:[e]},Object.defineProperty(t.prototype,"initialStateNodes",{get:function(){var e=this;if(et(this))return[this];if(this.type==="compound"&&!this.initial)return[this];var r=We(this.initialStateValue);return L(r.map(function(n){return e.getFromRelativePath(n)}))},enumerable:!1,configurable:!0}),t.prototype.getFromRelativePath=function(e){if(!e.length)return[this];var r=A(e),n=r[0],i=r.slice(1);if(!this.states)throw new Error("Cannot retrieve subPath '".concat(n,"' from node with no states"));var s=this.getStateNode(n);if(s.type==="history")return s.resolveHistory();if(!this.states[n])throw new Error("Child state '".concat(n,"' does not exist on '").concat(this.id,"'"));return this.states[n].getFromRelativePath(i)},t.prototype.historyValue=function(e){if(!!Object.keys(this.states).length)return{current:e||this.initialStateValue,states:dr(this.states,function(r,n){if(!e)return r.historyValue();var i=_(e)?void 0:e[n];return r.historyValue(i||r.initialStateValue)},function(r){return!r.history})}},t.prototype.resolveHistory=function(e){var r=this;if(this.type!=="history")return[this];var n=this.parent;if(!e){var i=this.target;return i?L(We(i).map(function(a){return n.getFromRelativePath(a)})):n.initialStateNodes}var s=Mn(n.path,"states")(e).current;return _(s)?[n.getStateNode(s)]:L(We(s).map(function(a){return r.history==="deep"?n.getFromRelativePath(a):[n.states[a[0]]]}))},Object.defineProperty(t.prototype,"stateIds",{get:function(){var e=this,r=L(Object.keys(this.states).map(function(n){return e.states[n].stateIds}));return[this.id].concat(r)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"events",{get:function(){var e,r,n,i;if(this.__cache.events)return this.__cache.events;var s=this.states,a=new Set(this.ownEvents);if(s)try{for(var o=b(Object.keys(s)),u=o.next();!u.done;u=o.next()){var f=u.value,c=s[f];if(c.states)try{for(var p=(n=void 0,b(c.events)),h=p.next();!h.done;h=p.next()){var l=h.value;a.add("".concat(l))}}catch(d){n={error:d}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(n)throw n.error}}}}catch(d){e={error:d}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(e)throw e.error}}return this.__cache.events=Array.from(a)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ownEvents",{get:function(){var e=new Set(this.transitions.filter(function(r){return!(!r.target&&!r.actions.length&&r.internal)}).map(function(r){return r.eventType}));return Array.from(e)},enumerable:!1,configurable:!0}),t.prototype.resolveTarget=function(e){var r=this;if(e!==void 0)return e.map(function(n){if(!_(n))return n;var i=n[0]===r.delimiter;if(i&&!r.parent)return r.getStateNodeByPath(n.slice(1));var s=i?r.key+n:n;if(r.parent)try{var a=r.parent.getStateNodeByPath(s);return a}catch(o){throw new Error("Invalid transition definition for state node '".concat(r.id,`':
`).concat(o.message))}else return r.getStateNodeByPath(s)})},t.prototype.formatTransition=function(e){var r=this,n=Gn(e.target),i="internal"in e?e.internal:n?n.some(function(u){return _(u)&&u[0]===r.delimiter}):!0,s=this.machine.options.guards,a=this.resolveTarget(n),o=y(y({},e),{actions:oe(z(e.actions)),cond:yr(e.cond,s),target:a,source:this,internal:i,eventType:e.event,toJSON:function(){return y(y({},o),{target:o.target?o.target.map(function(u){return"#".concat(u.id)}):void 0,source:"#".concat(r.id)})}});return o},t.prototype.formatTransitions=function(){var e,r,n=this,i;if(!this.config.on)i=[];else if(Array.isArray(this.config.on))i=this.config.on;else{var s=this.config.on,a=Ut,o=s[a],u=o===void 0?[]:o,f=Et(s,[typeof a=="symbol"?a:a+""]);i=L(Object.keys(f).map(function(g){var w=ye(g,f[g]);return w}).concat(ye(Ut,u)))}var c=this.config.always?ye("",this.config.always):[],p=this.config.onDone?ye(String(Qe(this.id)),this.config.onDone):[],h=L(this.invoke.map(function(g){var w=[];return g.onDone&&w.push.apply(w,D([],A(ye(String(Xe(g.id)),g.onDone)),!1)),g.onError&&w.push.apply(w,D([],A(ye(String(Le(g.id)),g.onError)),!1)),w})),l=this.after,d=L(D(D(D(D([],A(p),!1),A(h),!1),A(i),!1),A(c),!1).map(function(g){return z(g).map(function(w){return n.formatTransition(w)})}));try{for(var v=b(l),m=v.next();!m.done;m=v.next()){var E=m.value;d.push(E)}}catch(g){e={error:g}}finally{try{m&&!m.done&&(r=v.return)&&r.call(v)}finally{if(e)throw e.error}}return d},t}(),_r=!1;function Te(t,e){return!kn&&!t.predictableActionArguments&&!_r&&(_r=!0,console.warn("It is highly recommended to set `predictableActionArguments` to `true` when using `createMachine`. https://xstate.js.org/docs/guides/actions.html")),new Si(t,e)}var M=ei,q=Nt;function Ti(t){return new TextEncoder().encode(t)}function le(t){const e=new Uint8Array(t);let r="";for(const i of e)r+=String.fromCharCode(i);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Lt(t){const e=t.replace(/-/g,"+").replace(/_/g,"/"),r=(4-e.length%4)%4,n=e.padEnd(e.length+r,"="),i=atob(n),s=new ArrayBuffer(i.length),a=new Uint8Array(s);for(let o=0;o<i.length;o++)a[o]=i.charCodeAt(o);return s}function Nr(){return(window==null?void 0:window.PublicKeyCredential)!==void 0&&typeof window.PublicKeyCredential=="function"}function Pr(t){const{id:e}=t;return{...t,id:Lt(e),transports:t.transports}}function Cr(t){return t==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(t)}class V extends Error{constructor(e,r="WebAuthnError"){super(e),this.name=r}}function Ri({error:t,options:e}){var r,n;const{publicKey:i}=e;if(!i)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal===new AbortController().signal)return new V("Registration ceremony was sent an abort signal","AbortError")}else if(t.name==="ConstraintError"){if(((r=i.authenticatorSelection)===null||r===void 0?void 0:r.requireResidentKey)===!0)return new V("Discoverable credentials were required but no available authenticator supported it","ConstraintError");if(((n=i.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new V("User verification was required but no available authenticator supported it","ConstraintError")}else{if(t.name==="InvalidStateError")return new V("The authenticator was previously registered","InvalidStateError");if(t.name==="NotAllowedError")return new V("User clicked cancel, or the registration ceremony timed out","NotAllowedError");if(t.name==="NotSupportedError")return i.pubKeyCredParams.filter(a=>a.type==="public-key").length===0?new V('No entry in pubKeyCredParams was of type "public-key"',"NotSupportedError"):new V("No available authenticator supported any of the specified pubKeyCredParams algorithms","NotSupportedError");if(t.name==="SecurityError"){const s=window.location.hostname;if(Cr(s)){if(i.rp.id!==s)return new V(`The RP ID "${i.rp.id}" is invalid for this domain`,"SecurityError")}else return new V(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(t.name==="TypeError"){if(i.user.id.byteLength<1||i.user.id.byteLength>64)return new V("User ID was not between 1 and 64 characters","TypeError")}else if(t.name==="UnknownError")return new V("The authenticator was unable to process the specified options, or could not create a new credential","UnknownError")}return t}class bi{createNewAbortSignal(){return this.controller&&this.controller.abort(),this.controller=new AbortController,this.controller.signal}reset(){this.controller=void 0}}const st=new bi;async function Dr(t){if(!Nr())throw new Error("WebAuthn is not supported in this browser");const r={publicKey:{...t,challenge:Lt(t.challenge),user:{...t.user,id:Ti(t.user.id)},excludeCredentials:t.excludeCredentials.map(Pr)}};r.signal=st.createNewAbortSignal();let n;try{n=await navigator.credentials.create(r)}catch(f){throw Ri({error:f,options:r})}finally{st.reset()}if(!n)throw new Error("Registration was not completed");const{id:i,rawId:s,response:a,type:o}=n,u={id:i,rawId:le(s),response:{attestationObject:le(a.attestationObject),clientDataJSON:le(a.clientDataJSON)},type:o,clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:n.authenticatorAttachment};return typeof a.getTransports=="function"&&(u.transports=a.getTransports()),u}function Ai(t){return new TextDecoder("utf-8").decode(t)}async function Oi(){if(navigator.credentials.conditionalMediationSupported)return!0;const t=window.PublicKeyCredential;return t.isConditionalMediationAvailable!==void 0&&t.isConditionalMediationAvailable()}function xi({error:t,options:e}){var r;const{publicKey:n}=e;if(!n)throw Error("options was missing required publicKey property");if(t.name==="AbortError"){if(e.signal===new AbortController().signal)return new V("Authentication ceremony was sent an abort signal","AbortError")}else{if(t.name==="NotAllowedError")return!((r=n.allowCredentials)===null||r===void 0)&&r.length?new V("No available authenticator recognized any of the allowed credentials","NotAllowedError"):new V("User clicked cancel, or the authentication ceremony timed out","NotAllowedError");if(t.name==="SecurityError"){const i=window.location.hostname;if(Cr(i)){if(n.rpId!==i)return new V(`The RP ID "${n.rpId}" is invalid for this domain`,"SecurityError")}else return new V(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(t.name==="UnknownError")return new V("The authenticator was unable to process the specified options, or could not create a new assertion signature","UnknownError")}return t}async function Ii(t,e=!1){var r,n;if(!Nr())throw new Error("WebAuthn is not supported in this browser");let i;((r=t.allowCredentials)===null||r===void 0?void 0:r.length)!==0&&(i=(n=t.allowCredentials)===null||n===void 0?void 0:n.map(Pr));const s={...t,challenge:Lt(t.challenge),allowCredentials:i},a={};if(e){if(!await Oi())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete*='webauthn']").length<1)throw Error('No <input> with `"webauthn"` in its `autocomplete` attribute was detected');a.mediation="conditional",s.allowCredentials=[]}a.publicKey=s,a.signal=st.createNewAbortSignal();let o;try{o=await navigator.credentials.get(a)}catch(l){throw xi({error:l,options:a})}finally{st.reset()}if(!o)throw new Error("Authentication was not completed");const{id:u,rawId:f,response:c,type:p}=o;let h;return c.userHandle&&(h=Ai(c.userHandle)),{id:u,rawId:le(f),response:{authenticatorData:le(c.authenticatorData),clientDataJSON:le(c.clientDataJSON),signature:le(c.signature),userHandle:h},type:p,clientExtensionResults:o.getClientExtensionResults(),authenticatorAttachment:o.authenticatorAttachment}}const Fe="nhostRefreshToken",Ve="nhostRefreshTokenExpiresAt",kr=3,Ur=300,Lr=5,_i=30,Mt=0,jt=1,Y=10,Re=20;class Be extends Error{constructor(e){super(e.message),Error.captureStackTrace(this,this.constructor),e instanceof Error?(this.name=e.name,this.error={error:e.name,status:jt,message:e.message}):(this.name=e.error,this.error=e)}}const re={status:Y,error:"invalid-email",message:"Email is incorrectly formatted"},Mr={status:Y,error:"invalid-mfa-type",message:"MFA type is invalid"},jr={status:Y,error:"invalid-mfa-code",message:"MFA code is invalid"},at={status:Y,error:"invalid-password",message:"Password is incorrectly formatted"},$t={status:Y,error:"invalid-phone-number",message:"Phone number is incorrectly formatted"},$r={status:Y,error:"invalid-mfa-ticket",message:"MFA ticket is invalid"},Fr={status:Y,error:"no-mfa-ticket",message:"No MFA ticket has been provided"},Vr={status:Y,error:"no-refresh-token",message:"No refresh token has been provided"},Ni={status:Re,error:"refresher-already-running",message:"The token refresher is already running. You must wait until is has finished before submitting a new token."},ee={status:Re,error:"already-signed-in",message:"User is already signed in"},Br={status:Re,error:"unauthenticated-user",message:"User is not authenticated"},Pi={status:Re,error:"user-not-anonymous",message:"User is not anonymous"},Ci={status:Re,error:"unverified-user",message:"Email needs verification"},Di={status:Y,error:"invalid-refresh-token",message:"Invalid or expired refresh token"},ki={status:jt,error:"invalid-sign-in-method",message:"Invalid sign-in method"};var Ft={exports:{}},qr=function(e,r){return function(){for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];return e.apply(r,i)}},Ui=qr,Vt=Object.prototype.toString,Bt=function(t){return function(e){var r=Vt.call(e);return t[r]||(t[r]=r.slice(8,-1).toLowerCase())}}(Object.create(null));function fe(t){return t=t.toLowerCase(),function(r){return Bt(r)===t}}function qt(t){return Array.isArray(t)}function ot(t){return typeof t=="undefined"}function Li(t){return t!==null&&!ot(t)&&t.constructor!==null&&!ot(t.constructor)&&typeof t.constructor.isBuffer=="function"&&t.constructor.isBuffer(t)}var Kr=fe("ArrayBuffer");function Mi(t){var e;return typeof ArrayBuffer!="undefined"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&Kr(t.buffer),e}function ji(t){return typeof t=="string"}function $i(t){return typeof t=="number"}function Gr(t){return t!==null&&typeof t=="object"}function ut(t){if(Bt(t)!=="object")return!1;var e=Object.getPrototypeOf(t);return e===null||e===Object.prototype}var Fi=fe("Date"),Vi=fe("File"),Bi=fe("Blob"),qi=fe("FileList");function Kt(t){return Vt.call(t)==="[object Function]"}function Ki(t){return Gr(t)&&Kt(t.pipe)}function Gi(t){var e="[object FormData]";return t&&(typeof FormData=="function"&&t instanceof FormData||Vt.call(t)===e||Kt(t.toString)&&t.toString()===e)}var Hi=fe("URLSearchParams");function Wi(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function zi(){return typeof navigator!="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")?!1:typeof window!="undefined"&&typeof document!="undefined"}function Gt(t,e){if(!(t===null||typeof t=="undefined"))if(typeof t!="object"&&(t=[t]),qt(t))for(var r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.call(null,t[i],i,t)}function Ht(){var t={};function e(i,s){ut(t[s])&&ut(i)?t[s]=Ht(t[s],i):ut(i)?t[s]=Ht({},i):qt(i)?t[s]=i.slice():t[s]=i}for(var r=0,n=arguments.length;r<n;r++)Gt(arguments[r],e);return t}function Yi(t,e,r){return Gt(e,function(i,s){r&&typeof i=="function"?t[s]=Ui(i,r):t[s]=i}),t}function Ji(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}function Qi(t,e,r,n){t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,r&&Object.assign(t.prototype,r)}function Xi(t,e,r){var n,i,s,a={};e=e||{};do{for(n=Object.getOwnPropertyNames(t),i=n.length;i-- >0;)s=n[i],a[s]||(e[s]=t[s],a[s]=!0);t=Object.getPrototypeOf(t)}while(t&&(!r||r(t,e))&&t!==Object.prototype);return e}function Zi(t,e,r){t=String(t),(r===void 0||r>t.length)&&(r=t.length),r-=e.length;var n=t.indexOf(e,r);return n!==-1&&n===r}function es(t){if(!t)return null;var e=t.length;if(ot(e))return null;for(var r=new Array(e);e-- >0;)r[e]=t[e];return r}var ts=function(t){return function(e){return t&&e instanceof t}}(typeof Uint8Array!="undefined"&&Object.getPrototypeOf(Uint8Array)),B={isArray:qt,isArrayBuffer:Kr,isBuffer:Li,isFormData:Gi,isArrayBufferView:Mi,isString:ji,isNumber:$i,isObject:Gr,isPlainObject:ut,isUndefined:ot,isDate:Fi,isFile:Vi,isBlob:Bi,isFunction:Kt,isStream:Ki,isURLSearchParams:Hi,isStandardBrowserEnv:zi,forEach:Gt,merge:Ht,extend:Yi,trim:Wi,stripBOM:Ji,inherits:Qi,toFlatObject:Xi,kindOf:Bt,kindOfTest:fe,endsWith:Zi,toArray:es,isTypedArray:ts,isFileList:qi},be=B;function Hr(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Wr=function(e,r,n){if(!r)return e;var i;if(n)i=n(r);else if(be.isURLSearchParams(r))i=r.toString();else{var s=[];be.forEach(r,function(u,f){u===null||typeof u=="undefined"||(be.isArray(u)?f=f+"[]":u=[u],be.forEach(u,function(p){be.isDate(p)?p=p.toISOString():be.isObject(p)&&(p=JSON.stringify(p)),s.push(Hr(f)+"="+Hr(p))}))}),i=s.join("&")}if(i){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+i}return e},rs=B;function ct(){this.handlers=[]}ct.prototype.use=function(e,r,n){return this.handlers.push({fulfilled:e,rejected:r,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1},ct.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},ct.prototype.forEach=function(e){rs.forEach(this.handlers,function(n){n!==null&&e(n)})};var ns=ct,is=B,ss=function(e,r){is.forEach(e,function(i,s){s!==r&&s.toUpperCase()===r.toUpperCase()&&(e[r]=i,delete e[s])})},zr=B;function Ae(t,e,r,n,i){Error.call(this),this.message=t,this.name="AxiosError",e&&(this.code=e),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i)}zr.inherits(Ae,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var Yr=Ae.prototype,Jr={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(t){Jr[t]={value:t}}),Object.defineProperties(Ae,Jr),Object.defineProperty(Yr,"isAxiosError",{value:!0}),Ae.from=function(t,e,r,n,i,s){var a=Object.create(Yr);return zr.toFlatObject(t,a,function(u){return u!==Error.prototype}),Ae.call(a,t.message,e,r,n,i),a.name=t.name,s&&Object.assign(a,s),a};var Oe=Ae,Qr={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},J=B;function as(t,e){e=e||new FormData;var r=[];function n(s){return s===null?"":J.isDate(s)?s.toISOString():J.isArrayBuffer(s)||J.isTypedArray(s)?typeof Blob=="function"?new Blob([s]):Buffer.from(s):s}function i(s,a){if(J.isPlainObject(s)||J.isArray(s)){if(r.indexOf(s)!==-1)throw Error("Circular reference detected in "+a);r.push(s),J.forEach(s,function(u,f){if(!J.isUndefined(u)){var c=a?a+"."+f:f,p;if(u&&!a&&typeof u=="object"){if(J.endsWith(f,"{}"))u=JSON.stringify(u);else if(J.endsWith(f,"[]")&&(p=J.toArray(u))){p.forEach(function(h){!J.isUndefined(h)&&e.append(c,n(h))});return}}i(u,c)}}),r.pop()}else e.append(a,n(s))}return i(t),e}var Xr=as,Wt=Oe,os=function(e,r,n){var i=n.config.validateStatus;!n.status||!i||i(n.status)?e(n):r(new Wt("Request failed with status code "+n.status,[Wt.ERR_BAD_REQUEST,Wt.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))},lt=B,us=lt.isStandardBrowserEnv()?function(){return{write:function(r,n,i,s,a,o){var u=[];u.push(r+"="+encodeURIComponent(n)),lt.isNumber(i)&&u.push("expires="+new Date(i).toGMTString()),lt.isString(s)&&u.push("path="+s),lt.isString(a)&&u.push("domain="+a),o===!0&&u.push("secure"),document.cookie=u.join("; ")},read:function(r){var n=document.cookie.match(new RegExp("(^|;\\s*)("+r+")=([^;]*)"));return n?decodeURIComponent(n[3]):null},remove:function(r){this.write(r,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}(),cs=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},ls=function(e,r){return r?e.replace(/\/+$/,"")+"/"+r.replace(/^\/+/,""):e},fs=cs,ds=ls,Zr=function(e,r){return e&&!fs(r)?ds(e,r):r},zt=B,hs=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],vs=function(e){var r={},n,i,s;return e&&zt.forEach(e.split(`
`),function(o){if(s=o.indexOf(":"),n=zt.trim(o.substr(0,s)).toLowerCase(),i=zt.trim(o.substr(s+1)),n){if(r[n]&&hs.indexOf(n)>=0)return;n==="set-cookie"?r[n]=(r[n]?r[n]:[]).concat([i]):r[n]=r[n]?r[n]+", "+i:i}}),r},en=B,ps=en.isStandardBrowserEnv()?function(){var e=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a"),n;function i(s){var a=s;return e&&(r.setAttribute("href",a),a=r.href),r.setAttribute("href",a),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:r.pathname.charAt(0)==="/"?r.pathname:"/"+r.pathname}}return n=i(window.location.href),function(a){var o=en.isString(a)?i(a):a;return o.protocol===n.protocol&&o.host===n.host}}():function(){return function(){return!0}}(),Yt=Oe,ms=B;function tn(t){Yt.call(this,t==null?"canceled":t,Yt.ERR_CANCELED),this.name="CanceledError"}ms.inherits(tn,Yt,{__CANCEL__:!0});var ft=tn,ys=function(e){var r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return r&&r[1]||""},qe=B,gs=os,Es=us,ws=Wr,Ss=Zr,Ts=vs,Rs=ps,bs=Qr,ne=Oe,As=ft,Os=ys,rn=function(e){return new Promise(function(n,i){var s=e.data,a=e.headers,o=e.responseType,u;function f(){e.cancelToken&&e.cancelToken.unsubscribe(u),e.signal&&e.signal.removeEventListener("abort",u)}qe.isFormData(s)&&qe.isStandardBrowserEnv()&&delete a["Content-Type"];var c=new XMLHttpRequest;if(e.auth){var p=e.auth.username||"",h=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.Authorization="Basic "+btoa(p+":"+h)}var l=Ss(e.baseURL,e.url);c.open(e.method.toUpperCase(),ws(l,e.params,e.paramsSerializer),!0),c.timeout=e.timeout;function d(){if(!!c){var E="getAllResponseHeaders"in c?Ts(c.getAllResponseHeaders()):null,g=!o||o==="text"||o==="json"?c.responseText:c.response,w={data:g,status:c.status,statusText:c.statusText,headers:E,config:e,request:c};gs(function(R){n(R),f()},function(R){i(R),f()},w),c=null}}if("onloadend"in c?c.onloadend=d:c.onreadystatechange=function(){!c||c.readyState!==4||c.status===0&&!(c.responseURL&&c.responseURL.indexOf("file:")===0)||setTimeout(d)},c.onabort=function(){!c||(i(new ne("Request aborted",ne.ECONNABORTED,e,c)),c=null)},c.onerror=function(){i(new ne("Network Error",ne.ERR_NETWORK,e,c,c)),c=null},c.ontimeout=function(){var g=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",w=e.transitional||bs;e.timeoutErrorMessage&&(g=e.timeoutErrorMessage),i(new ne(g,w.clarifyTimeoutError?ne.ETIMEDOUT:ne.ECONNABORTED,e,c)),c=null},qe.isStandardBrowserEnv()){var v=(e.withCredentials||Rs(l))&&e.xsrfCookieName?Es.read(e.xsrfCookieName):void 0;v&&(a[e.xsrfHeaderName]=v)}"setRequestHeader"in c&&qe.forEach(a,function(g,w){typeof s=="undefined"&&w.toLowerCase()==="content-type"?delete a[w]:c.setRequestHeader(w,g)}),qe.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),o&&o!=="json"&&(c.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&c.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&c.upload&&c.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(u=function(E){!c||(i(!E||E&&E.type?new As:E),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(u),e.signal&&(e.signal.aborted?u():e.signal.addEventListener("abort",u))),s||(s=null);var m=Os(l);if(m&&["http","https","file"].indexOf(m)===-1){i(new ne("Unsupported protocol "+m+":",ne.ERR_BAD_REQUEST,e));return}c.send(s)})},xs=null,j=B,nn=ss,sn=Oe,Is=Qr,_s=Xr,Ns={"Content-Type":"application/x-www-form-urlencoded"};function an(t,e){!j.isUndefined(t)&&j.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}function Ps(){var t;return(typeof XMLHttpRequest!="undefined"||typeof process!="undefined"&&Object.prototype.toString.call(process)==="[object process]")&&(t=rn),t}function Cs(t,e,r){if(j.isString(t))try{return(e||JSON.parse)(t),j.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(r||JSON.stringify)(t)}var dt={transitional:Is,adapter:Ps(),transformRequest:[function(e,r){if(nn(r,"Accept"),nn(r,"Content-Type"),j.isFormData(e)||j.isArrayBuffer(e)||j.isBuffer(e)||j.isStream(e)||j.isFile(e)||j.isBlob(e))return e;if(j.isArrayBufferView(e))return e.buffer;if(j.isURLSearchParams(e))return an(r,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n=j.isObject(e),i=r&&r["Content-Type"],s;if((s=j.isFileList(e))||n&&i==="multipart/form-data"){var a=this.env&&this.env.FormData;return _s(s?{"files[]":e}:e,a&&new a)}else if(n||i==="application/json")return an(r,"application/json"),Cs(e);return e}],transformResponse:[function(e){var r=this.transitional||dt.transitional,n=r&&r.silentJSONParsing,i=r&&r.forcedJSONParsing,s=!n&&this.responseType==="json";if(s||i&&j.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(s)throw a.name==="SyntaxError"?sn.from(a,sn.ERR_BAD_RESPONSE,this,null,this.response):a}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:xs},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};j.forEach(["delete","get","head"],function(e){dt.headers[e]={}}),j.forEach(["post","put","patch"],function(e){dt.headers[e]=j.merge(Ns)});var Jt=dt,Ds=B,ks=Jt,Us=function(e,r,n){var i=this||ks;return Ds.forEach(n,function(a){e=a.call(i,e,r)}),e},on=function(e){return!!(e&&e.__CANCEL__)},un=B,Qt=Us,Ls=on,Ms=Jt,js=ft;function Xt(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new js}var $s=function(e){Xt(e),e.headers=e.headers||{},e.data=Qt.call(e,e.data,e.headers,e.transformRequest),e.headers=un.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),un.forEach(["delete","get","head","post","put","patch","common"],function(i){delete e.headers[i]});var r=e.adapter||Ms.adapter;return r(e).then(function(i){return Xt(e),i.data=Qt.call(e,i.data,i.headers,e.transformResponse),i},function(i){return Ls(i)||(Xt(e),i&&i.response&&(i.response.data=Qt.call(e,i.response.data,i.response.headers,e.transformResponse))),Promise.reject(i)})},W=B,cn=function(e,r){r=r||{};var n={};function i(c,p){return W.isPlainObject(c)&&W.isPlainObject(p)?W.merge(c,p):W.isPlainObject(p)?W.merge({},p):W.isArray(p)?p.slice():p}function s(c){if(W.isUndefined(r[c])){if(!W.isUndefined(e[c]))return i(void 0,e[c])}else return i(e[c],r[c])}function a(c){if(!W.isUndefined(r[c]))return i(void 0,r[c])}function o(c){if(W.isUndefined(r[c])){if(!W.isUndefined(e[c]))return i(void 0,e[c])}else return i(void 0,r[c])}function u(c){if(c in r)return i(e[c],r[c]);if(c in e)return i(void 0,e[c])}var f={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:u};return W.forEach(Object.keys(e).concat(Object.keys(r)),function(p){var h=f[p]||s,l=h(p);W.isUndefined(l)&&h!==u||(n[p]=l)}),n},ln={version:"0.27.2"},Fs=ln.version,ue=Oe,Zt={};["object","boolean","number","function","string","symbol"].forEach(function(t,e){Zt[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});var fn={};Zt.transitional=function(e,r,n){function i(s,a){return"[Axios v"+Fs+"] Transitional option '"+s+"'"+a+(n?". "+n:"")}return function(s,a,o){if(e===!1)throw new ue(i(a," has been removed"+(r?" in "+r:"")),ue.ERR_DEPRECATED);return r&&!fn[a]&&(fn[a]=!0,console.warn(i(a," has been deprecated since v"+r+" and will be removed in the near future"))),e?e(s,a,o):!0}};function Vs(t,e,r){if(typeof t!="object")throw new ue("options must be an object",ue.ERR_BAD_OPTION_VALUE);for(var n=Object.keys(t),i=n.length;i-- >0;){var s=n[i],a=e[s];if(a){var o=t[s],u=o===void 0||a(o,s,t);if(u!==!0)throw new ue("option "+s+" must be "+u,ue.ERR_BAD_OPTION_VALUE);continue}if(r!==!0)throw new ue("Unknown option "+s,ue.ERR_BAD_OPTION)}}var Bs={assertOptions:Vs,validators:Zt},dn=B,qs=Wr,hn=ns,vn=$s,ht=cn,Ks=Zr,pn=Bs,xe=pn.validators;function Ie(t){this.defaults=t,this.interceptors={request:new hn,response:new hn}}Ie.prototype.request=function(e,r){typeof e=="string"?(r=r||{},r.url=e):r=e||{},r=ht(this.defaults,r),r.method?r.method=r.method.toLowerCase():this.defaults.method?r.method=this.defaults.method.toLowerCase():r.method="get";var n=r.transitional;n!==void 0&&pn.assertOptions(n,{silentJSONParsing:xe.transitional(xe.boolean),forcedJSONParsing:xe.transitional(xe.boolean),clarifyTimeoutError:xe.transitional(xe.boolean)},!1);var i=[],s=!0;this.interceptors.request.forEach(function(l){typeof l.runWhen=="function"&&l.runWhen(r)===!1||(s=s&&l.synchronous,i.unshift(l.fulfilled,l.rejected))});var a=[];this.interceptors.response.forEach(function(l){a.push(l.fulfilled,l.rejected)});var o;if(!s){var u=[vn,void 0];for(Array.prototype.unshift.apply(u,i),u=u.concat(a),o=Promise.resolve(r);u.length;)o=o.then(u.shift(),u.shift());return o}for(var f=r;i.length;){var c=i.shift(),p=i.shift();try{f=c(f)}catch(h){p(h);break}}try{o=vn(f)}catch(h){return Promise.reject(h)}for(;a.length;)o=o.then(a.shift(),a.shift());return o},Ie.prototype.getUri=function(e){e=ht(this.defaults,e);var r=Ks(e.baseURL,e.url);return qs(r,e.params,e.paramsSerializer)},dn.forEach(["delete","get","head","options"],function(e){Ie.prototype[e]=function(r,n){return this.request(ht(n||{},{method:e,url:r,data:(n||{}).data}))}}),dn.forEach(["post","put","patch"],function(e){function r(n){return function(s,a,o){return this.request(ht(o||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:s,data:a}))}}Ie.prototype[e]=r(),Ie.prototype[e+"Form"]=r(!0)});var Gs=Ie,Hs=ft;function _e(t){if(typeof t!="function")throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(i){e=i});var r=this;this.promise.then(function(n){if(!!r._listeners){var i,s=r._listeners.length;for(i=0;i<s;i++)r._listeners[i](n);r._listeners=null}}),this.promise.then=function(n){var i,s=new Promise(function(a){r.subscribe(a),i=a}).then(n);return s.cancel=function(){r.unsubscribe(i)},s},t(function(i){r.reason||(r.reason=new Hs(i),e(r.reason))})}_e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},_e.prototype.subscribe=function(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]},_e.prototype.unsubscribe=function(e){if(!!this._listeners){var r=this._listeners.indexOf(e);r!==-1&&this._listeners.splice(r,1)}},_e.source=function(){var e,r=new _e(function(i){e=i});return{token:r,cancel:e}};var Ws=_e,zs=function(e){return function(n){return e.apply(null,n)}},Ys=B,Js=function(e){return Ys.isObject(e)&&e.isAxiosError===!0},mn=B,Qs=qr,vt=Gs,Xs=cn,Zs=Jt;function yn(t){var e=new vt(t),r=Qs(vt.prototype.request,e);return mn.extend(r,vt.prototype,e),mn.extend(r,e),r.create=function(i){return yn(Xs(t,i))},r}var G=yn(Zs);G.Axios=vt,G.CanceledError=ft,G.CancelToken=Ws,G.isCancel=on,G.VERSION=ln.version,G.toFormData=Xr,G.AxiosError=Oe,G.Cancel=G.CanceledError,G.all=function(e){return Promise.all(e)},G.spread=zs,G.isAxiosError=Js,Ft.exports=G,Ft.exports.default=G;var ea=Ft.exports;const de=t=>{const e=ea.create({baseURL:t});return e.interceptors.response.use(r=>r,r=>{var n,i,s,a,o,u,f,c,p,h,l;return Promise.reject({error:{message:(o=(a=(s=(i=(n=r.response)==null?void 0:n.data)==null?void 0:i.message)!=null?s:r.message)!=null?a:r.request.responseText)!=null?o:JSON.stringify(r),status:(p=(c=(u=r.response)==null?void 0:u.status)!=null?c:(f=r.response)==null?void 0:f.data.statusCode)!=null?p:Mt,error:((l=(h=r.response)==null?void 0:h.data)==null?void 0:l.error)||r.request.statusText||"network"}})}),e};/*! js-cookie v3.0.1 | MIT */function pt(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)t[n]=r[n]}return t}var ta={read:function(t){return t[0]==='"'&&(t=t.slice(1,-1)),t.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(t){return encodeURIComponent(t).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function er(t,e){function r(i,s,a){if(typeof document!="undefined"){a=pt({},e,a),typeof a.expires=="number"&&(a.expires=new Date(Date.now()+a.expires*864e5)),a.expires&&(a.expires=a.expires.toUTCString()),i=encodeURIComponent(i).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var u in a)!a[u]||(o+="; "+u,a[u]!==!0&&(o+="="+a[u].split(";")[0]));return document.cookie=i+"="+t.write(s,i)+o}}function n(i){if(!(typeof document=="undefined"||arguments.length&&!i)){for(var s=document.cookie?document.cookie.split("; "):[],a={},o=0;o<s.length;o++){var u=s[o].split("="),f=u.slice(1).join("=");try{var c=decodeURIComponent(u[0]);if(a[c]=t.read(f,c),i===c)break}catch{}}return i?a[i]:a}}return Object.create({set:r,get:n,remove:function(i,s){r(i,"",pt({},s,{expires:-1}))},withAttributes:function(i){return er(this.converter,pt({},this.attributes,i))},withConverter:function(i){return er(pt({},this.converter,i),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(t)}})}var tr=er(ta,{path:"/"});const mt=typeof window!="undefined",yt=new Map,ra=t=>{var e;return mt&&typeof localStorage!="undefined"?localStorage.getItem(t):(e=yt.get(t))!=null?e:null},na=(t,e)=>{mt&&typeof localStorage!="undefined"?e?localStorage.setItem(t,e):localStorage.removeItem(t):e?yt.set(t,e):yt.has(t)&&yt.delete(t)},gn=(t,e)=>{if(t==="localStorage"||t==="web")return ra;if(t==="cookie")return r=>{var n;return mt&&(n=tr.get(r))!=null?n:null};if(!e)throw Error(`clientStorageType is set to '${t}' but no clientStorage has been given`);if(t==="react-native")return r=>{var n;return(n=e.getItem)==null?void 0:n.call(e,r)};if(t==="capacitor")return r=>{var n;return(n=e.get)==null?void 0:n.call(e,{key:r})};if(t==="expo-secure-storage")return r=>{var n;return(n=e.getItemAsync)==null?void 0:n.call(e,r)};if(t==="custom"){if(e.getItem&&e.removeItem)return e.getItem;if(e.getItemAsync)return e.getItemAsync;throw Error(`clientStorageType is set to 'custom' but clientStorage is missing either "getItem" and "removeItem" properties or "getItemAsync" property`)}throw Error(`Unknown storage type: ${t}`)},En=(t,e)=>{if(t==="localStorage"||t==="web")return na;if(t==="cookie")return(r,n)=>{mt&&(n?tr.set(r,n,{expires:30}):tr.remove(r))};if(!e)throw Error(`clientStorageType is set to '${t}' but no clienStorage has been given`);if(t==="react-native")return(r,n)=>{var i,s;return n?(i=e.setItem)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};if(t==="capacitor")return(r,n)=>{var i,s;return n?(i=e.set)==null?void 0:i.call(e,{key:r,value:n}):(s=e.remove)==null?void 0:s.call(e,{key:r})};if(t==="expo-secure-storage")return async(r,n)=>{var i,s;return n?(i=e.setItemAsync)==null?void 0:i.call(e,r,n):(s=e.deleteItemAsync)==null?void 0:s.call(e,r)};if(t==="custom"){if(!e.removeItem)throw Error("clientStorageType is set to 'custom' but clientStorage is missing a removeItem property");if(e.setItem)return(r,n)=>{var i,s;return n?(i=e.setItem)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};if(e.setItemAsync)return async(r,n)=>{var i,s;return n?(i=e.setItemAsync)==null?void 0:i.call(e,r,n):(s=e.removeItem)==null?void 0:s.call(e,r)};throw Error("clientStorageType is set to 'custom' but clientStorage is missing setItem or setItemAsync property")}throw Error(`Unknown storage type: ${t}`)},wn=(t,e)=>{const r=e&&Object.entries(e).map(([n,i])=>{const s=Array.isArray(i)?i.join(","):typeof i=="object"?JSON.stringify(i):i;return`${n}=${encodeURIComponent(s)}`}).join("&");return r?`${t}?${r}`:t},te=(t,e)=>{if(!(e!=null&&e.redirectTo))return e;const{redirectTo:r,...n}=e;if(!t)return r.startsWith("/")?n:e;const i=new URL(t),s=Object.fromEntries(new URLSearchParams(i.search)),a=new URL(r.startsWith("/")?i.origin+r:r),o=new URLSearchParams(a.search);let u=Object.fromEntries(o);r.startsWith("/")&&(u={...s,...u});let f=i.pathname;return a.pathname.length>1&&(f+=a.pathname.slice(1)),{...n,redirectTo:wn(a.origin+f,u)}};function Ke(t,e){var i;if(!e){if(typeof window=="undefined")return;e=((i=window.location)==null?void 0:i.href)||""}t=t.replace(/[\[\]]/g,"\\$&");const r=new RegExp("[?&#]"+t+"(=([^&#]*)|&|#|$)"),n=r.exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}function rr(t){var r;if(typeof window=="undefined")return;const e=window==null?void 0:window.location;if(!!e&&e){const n=new URLSearchParams(e.search),i=new URLSearchParams((r=e.hash)==null?void 0:r.slice(1));n.delete(t),i.delete(t);let s=window.location.pathname;Array.from(n).length&&(s+=`?${n.toString()}`),Array.from(i).length&&(s+=`#${i.toString()}`),window.history.pushState({},"",s)}}const ce=t=>!!t&&typeof t=="string"&&!!String(t).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/),nr=t=>!!t&&typeof t=="string"&&t.length>=kr,Sn=t=>!!t&&typeof t=="string",ia=t=>t&&typeof t=="string"&&t.match(/^mfaTotp:[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i),ir={user:null,mfa:null,accessToken:{value:null,expiresAt:null},refreshTimer:{startedAt:null,attempts:0,lastAttempt:null},refreshToken:{value:null},importTokenAttempts:0,errors:{}},sa=({backendUrl:t,clientUrl:e,interpreter:r})=>{const n=de(t);return Te({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"changeEmail",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:M({error:i=>re}),saveRequestError:M({error:(i,{data:{error:s}})=>s}),reportError:q(i=>({type:"ERROR",error:i.error})),reportSuccess:q("SUCCESS")},guards:{invalidEmail:(i,{email:s})=>!ce(s)},services:{requestChange:async(i,{email:s,options:a})=>(await n.post("/user/email/change",{newEmail:s,options:te(e,a)},{headers:{authorization:`Bearer ${r==null?void 0:r.state.context.accessToken.value}`}})).data}})},aa=({backendUrl:t,interpreter:e})=>{const r=de(t);return Te({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"changePassword",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidPassword",actions:"saveInvalidPasswordError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidPasswordError:M({error:n=>at}),saveRequestError:M({error:(n,{data:{error:i}})=>i}),reportError:q(n=>({type:"ERROR",error:n.error})),reportSuccess:q("SUCCESS")},guards:{invalidPassword:(n,{password:i})=>!nr(i)},services:{requestChange:(n,{password:i,ticket:s})=>r.post("/user/password",{newPassword:i,ticket:s},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}})}})},oa=({backendUrl:t,interpreter:e})=>{const r=de(t);return Te({schema:{context:{},events:{}},tsTypes:{},predictableActionArguments:!0,id:"enableMfa",initial:"idle",context:{error:null,imageUrl:null,secret:null},states:{idle:{initial:"initial",on:{GENERATE:"generating"},states:{initial:{},error:{}}},generating:{invoke:{src:"generate",id:"generate",onDone:{target:"generated",actions:["reportGeneratedSuccess","saveGeneration"]},onError:{actions:["saveError","reportGeneratedError"],target:"idle.error"}}},generated:{initial:"idle",states:{idle:{initial:"idle",on:{ACTIVATE:[{cond:"invalidMfaType",actions:"saveInvalidMfaTypeError",target:".error"},{cond:"invalidMfaCode",actions:"saveInvalidMfaCodeError",target:".error"},{target:"activating"}]},states:{idle:{},error:{}}},activating:{invoke:{src:"activate",id:"activate",onDone:{target:"activated",actions:"reportSuccess"},onError:{actions:["saveError","reportError"],target:"idle.error"}}},activated:{type:"final"}}}}},{actions:{saveInvalidMfaTypeError:M({error:n=>Mr}),saveInvalidMfaCodeError:M({error:n=>jr}),saveError:M({error:(n,{data:{error:i}})=>i}),saveGeneration:M({imageUrl:(n,{data:{imageUrl:i}})=>i,secret:(n,{data:{totpSecret:i}})=>i}),reportError:q(n=>({type:"ERROR",error:n.error})),reportSuccess:q("SUCCESS"),reportGeneratedSuccess:q("GENERATED"),reportGeneratedError:q(n=>({type:"GENERATED_ERROR",error:n.error}))},guards:{invalidMfaCode:(n,{code:i})=>!i,invalidMfaType:(n,{activeMfaType:i})=>!i||i!=="totp"},services:{generate:async n=>{const{data:i}=await r.get("/mfa/totp/generate",{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}});return i},activate:(n,{code:i,activeMfaType:s})=>r.post("/user/mfa",{code:i,activeMfaType:s},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}})}})},ua=({backendUrl:t,clientUrl:e})=>{const r=de(t);return Te({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"changePassword",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"requestChange",id:"requestChange",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:M({error:n=>re}),saveRequestError:M({error:(n,{data:{error:i}})=>i}),reportError:q(n=>({type:"ERROR",error:n.error})),reportSuccess:q("SUCCESS")},guards:{invalidEmail:(n,{email:i})=>!ce(i)},services:{requestChange:(n,{email:i,options:s})=>r.post("/user/password/reset",{email:i,options:te(e,s)})}})},ca=({backendUrl:t,clientUrl:e})=>{const r=de(t);return Te({schema:{context:{},events:{},services:{}},tsTypes:{},predictableActionArguments:!0,id:"sendVerificationEmail",initial:"idle",context:{error:null},states:{idle:{on:{REQUEST:[{cond:"invalidEmail",actions:"saveInvalidEmailError",target:".error"},{target:"requesting"}]},initial:"initial",states:{initial:{},success:{},error:{}}},requesting:{invoke:{src:"request",id:"request",onDone:{target:"idle.success",actions:"reportSuccess"},onError:{actions:["saveRequestError","reportError"],target:"idle.error"}}}}},{actions:{saveInvalidEmailError:M({error:n=>re}),saveRequestError:M({error:(n,{data:{error:i}})=>i}),reportError:q(n=>({type:"ERROR",error:n.error})),reportSuccess:q("SUCCESS")},guards:{invalidEmail:(n,{email:i})=>!ce(i)},services:{request:async(n,{email:i,options:s})=>(await r.post("/user/email/send-verification-email",{email:i,options:te(e,s)})).data}})},Tn=({backendUrl:t,clientUrl:e,clientStorageGetter:r,clientStorageSetter:n,clientStorageType:i="web",clientStorage:s,refreshIntervalTime:a,autoRefreshToken:o=!0,autoSignIn:u=!0})=>{const f=r||gn(i,s),c=n||En(i,s),p=de(t),h=async(l,d,v)=>(await p.post(l,d,v)).data;return Te({schema:{context:{},events:{},services:{}},tsTypes:{},context:ir,predictableActionArguments:!0,id:"nhost",type:"parallel",states:{authentication:{initial:"starting",on:{SESSION_UPDATE:[{cond:"hasSession",actions:["saveSession","resetTimer","reportTokenChanged"],target:".signedIn"}]},states:{starting:{tags:["loading"],always:{cond:"isSignedIn",target:"signedIn"},invoke:{id:"importRefreshToken",src:"importRefreshToken",onDone:{actions:["saveSession","reportTokenChanged"],target:"signedIn"},onError:[{cond:"shouldRetryImportToken",actions:"incrementTokenImportAttempts",target:"retryTokenImport"},{actions:["saveAuthenticationError"],target:"signedOut"}]}},retryTokenImport:{tags:["loading"],after:{RETRY_IMPORT_TOKEN_DELAY:"starting"}},signedOut:{initial:"noErrors",entry:"reportSignedOut",states:{noErrors:{},success:{},needsSmsOtp:{},needsMfa:{},failed:{},signingOut:{entry:["clearContextExceptRefreshToken"],exit:["destroyRefreshToken","reportTokenChanged"],invoke:{src:"signout",id:"signingOut",onDone:{target:"success"},onError:{target:"failed",actions:["saveAuthenticationError"]}}}},on:{SIGNIN_PASSWORD:"authenticating.password",SIGNIN_ANONYMOUS:"authenticating.anonymous",SIGNIN_SECURITY_KEY_EMAIL:"authenticating.securityKeyEmail",SIGNIN_MFA_TOTP:"authenticating.mfa.totp"}},authenticating:{entry:"resetErrors",states:{password:{invoke:{src:"signInPassword",id:"authenticateUserWithPassword",onDone:[{cond:"hasMfaTicket",actions:["saveMfaTicket"],target:"#nhost.authentication.signedOut.needsMfa"},{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"}],onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}},anonymous:{invoke:{src:"signInAnonymous",id:"authenticateAnonymously",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}}},mfa:{states:{totp:{invoke:{src:"signInMfaTotp",id:"signInMfaTotp",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:["saveAuthenticationError"],target:"#nhost.authentication.signedOut.failed"}}}}},securityKeyEmail:{invoke:{src:"signInSecurityKeyEmail",id:"authenticateUserWithSecurityKey",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:[{cond:"unverified",target:["#nhost.authentication.signedOut","#nhost.registration.incomplete.needsEmailVerification"]},{actions:"saveAuthenticationError",target:"#nhost.authentication.signedOut.failed"}]}}}},signedIn:{type:"parallel",entry:["reportSignedIn","cleanUrl","broadcastToken","resetErrors"],on:{SIGNOUT:"signedOut.signingOut"},states:{refreshTimer:{id:"timer",initial:"idle",states:{disabled:{type:"final"},stopped:{always:{cond:"noToken",target:"idle"}},idle:{always:[{cond:"isAutoRefreshDisabled",target:"disabled"},{cond:"hasRefreshToken",target:"running"}]},running:{initial:"pending",entry:"resetTimer",states:{pending:{after:{1e3:{internal:!1,target:"pending"}},always:{cond:"refreshTimerShouldRefresh",target:"refreshing"}},refreshing:{invoke:{src:"refreshToken",id:"refreshToken",onDone:{actions:["saveSession","resetTimer","reportTokenChanged"],target:"pending"},onError:[{actions:"saveRefreshAttempt",target:"pending"}]}}}}}}}}}},token:{initial:"idle",states:{idle:{on:{TRY_TOKEN:"running"},initial:"noErrors",states:{noErrors:{},error:{}}},running:{invoke:{src:"refreshToken",id:"authenticateWithToken",onDone:{actions:["saveSession","reportTokenChanged"],target:["#nhost.authentication.signedIn","idle.noErrors"]},onError:[{cond:"isSignedIn",target:"idle.error"},{actions:"saveAuthenticationError",target:["#nhost.authentication.signedOut.failed","idle.error"]}]}}}},registration:{initial:"incomplete",on:{SIGNED_IN:[{cond:"isAnonymous",target:".incomplete"},".complete"]},states:{incomplete:{on:{SIGNUP_EMAIL_PASSWORD:"emailPassword",SIGNUP_SECURITY_KEY:"securityKey",PASSWORDLESS_EMAIL:"passwordlessEmail",PASSWORDLESS_SMS:"passwordlessSms",PASSWORDLESS_SMS_OTP:"passwordlessSmsOtp"},initial:"noErrors",states:{noErrors:{},needsEmailVerification:{},needsOtp:{},failed:{}}},emailPassword:{entry:["resetErrors"],invoke:{src:"signUpEmailPassword",id:"signUpEmailPassword",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]}],onError:[{cond:"unverified",target:"incomplete.needsEmailVerification"},{actions:"saveRegistrationError",target:"incomplete.failed"}]}},securityKey:{entry:["resetErrors"],invoke:{src:"signUpSecurityKey",id:"signUpSecurityKey",onDone:[{cond:"hasSession",actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]}],onError:[{cond:"unverified",target:"incomplete.needsEmailVerification"},{actions:"saveRegistrationError",target:"incomplete.failed"}]}},passwordlessEmail:{entry:["resetErrors"],invoke:{src:"passwordlessEmail",id:"passwordlessEmail",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsEmailVerification"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},passwordlessSms:{entry:["resetErrors"],invoke:{src:"passwordlessSms",id:"passwordlessSms",onDone:{actions:"clearContext",target:["#nhost.authentication.signedOut","incomplete.needsOtp"]},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},passwordlessSmsOtp:{entry:["resetErrors"],invoke:{src:"passwordlessSmsOtp",id:"passwordlessSmsOtp",onDone:{actions:["saveSession","reportTokenChanged"],target:"#nhost.authentication.signedIn"},onError:{actions:"saveRegistrationError",target:"incomplete.failed"}}},complete:{on:{SIGNED_OUT:"incomplete"}}}}}},{actions:{reportSignedIn:q("SIGNED_IN"),reportSignedOut:q("SIGNED_OUT"),reportTokenChanged:q("TOKEN_CHANGED"),incrementTokenImportAttempts:M({importTokenAttempts:({importTokenAttempts:l})=>l+1}),clearContext:M(()=>(c(Ve,null),c(Fe,null),{...ir})),clearContextExceptRefreshToken:M(({refreshToken:{value:l}})=>(c(Ve,null),{...ir,refreshToken:{value:l}})),saveSession:M({user:(l,{data:d})=>{var v;return((v=d==null?void 0:d.session)==null?void 0:v.user)||null},accessToken:(l,{data:d})=>{if(d.session){const{accessTokenExpiresIn:v,accessToken:m}=d.session,E=new Date(Date.now()+v*1e3);return c(Ve,E.toISOString()),{value:m,expiresAt:E}}return c(Ve,null),{value:null,expiresAt:null}},refreshToken:(l,{data:d})=>{var m;const v=((m=d.session)==null?void 0:m.refreshToken)||null;return v&&c(Fe,v),{value:v}}}),saveMfaTicket:M({mfa:(l,d)=>{var v;return(v=d.data)==null?void 0:v.mfa}}),resetTimer:M({refreshTimer:l=>({startedAt:new Date,attempts:0,lastAttempt:null})}),saveRefreshAttempt:M({refreshTimer:(l,d)=>({startedAt:l.refreshTimer.startedAt,attempts:l.refreshTimer.attempts+1,lastAttempt:new Date})}),saveAuthenticationError:M({errors:({errors:l},{data:{error:d}})=>({...l,authentication:d})}),resetErrors:M({errors:l=>({}),importTokenAttempts:l=>0}),saveRegistrationError:M({errors:({errors:l},{data:{error:d}})=>({...l,registration:d})}),destroyRefreshToken:M({refreshToken:l=>(c(Fe,null),{value:null})}),cleanUrl:()=>{u&&Ke("refreshToken")&&(rr("refreshToken"),rr("type"))},broadcastToken:l=>{if(u)try{new BroadcastChannel("nhost").postMessage(l.refreshToken.value)}catch{}}},guards:{isAnonymous:(l,d)=>{var v;return!!((v=l.user)!=null&&v.isAnonymous)},isSignedIn:l=>!!l.user&&!!l.refreshToken.value&&!!l.accessToken.value,noToken:l=>!l.refreshToken.value,hasRefreshToken:l=>!!l.refreshToken.value,isAutoRefreshDisabled:()=>!o,refreshTimerShouldRefresh:l=>{const{expiresAt:d}=l.accessToken;return d?l.refreshTimer.lastAttempt?Date.now()-l.refreshTimer.lastAttempt.getTime()>Lr*1e3:a&&Date.now()-l.refreshTimer.startedAt.getTime()>a*1e3?!0:d.getTime()-Date.now()-1e3*Ur<=0:!1},shouldRetryImportToken:(l,d)=>d.data.error.status===Mt||d.data.error.status>=500,unverified:(l,{data:{error:d}})=>d.status===401&&(d.message==="Email is not verified"||d.error==="unverified-user"),hasSession:(l,d)=>{var v;return!!((v=d.data)!=null&&v.session)},hasMfaTicket:(l,d)=>{var v;return!!((v=d.data)!=null&&v.mfa)}},services:{signInPassword:(l,{email:d,password:v})=>ce(d)?nr(v)?h("/signin/email-password",{email:d,password:v}):Promise.reject({error:at}):Promise.reject({error:re}),passwordlessSms:(l,{phoneNumber:d,options:v})=>{var m;return Sn(d)?(m=l.user)!=null&&m.isAnonymous?(console.warn("Deanonymisation from a phone number is not yet implemented in hasura-auth"),h("/user/deanonymize",{signInMethod:"passwordless",connection:"sms",phoneNumber:d,options:te(e,v)},{headers:{authorization:`Bearer ${l.accessToken.value}`}})):h("/signin/passwordless/sms",{phoneNumber:d,options:te(e,v)}):Promise.reject({error:$t})},passwordlessSmsOtp:(l,{phoneNumber:d,otp:v})=>Sn(d)?h("/signin/passwordless/sms/otp",{phoneNumber:d,otp:v}):Promise.reject({error:$t}),passwordlessEmail:(l,{email:d,options:v})=>{var m;return ce(d)?(m=l.user)!=null&&m.isAnonymous?h("/user/deanonymize",{signInMethod:"passwordless",connection:"email",email:d,options:te(e,v)},{headers:{authorization:`Bearer ${l.accessToken.value}`}}):h("/signin/passwordless/email",{email:d,options:te(e,v)}):Promise.reject({error:re})},signInAnonymous:l=>h("/signin/anonymous"),signInMfaTotp:(l,d)=>{var m;const v=d.ticket||((m=l.mfa)==null?void 0:m.ticket);return v?ia(v)?h("/signin/mfa/totp",{ticket:v,otp:d.otp}):Promise.reject({error:$r}):Promise.reject({error:Fr})},signInSecurityKeyEmail:async(l,{email:d})=>{if(!ce(d))throw new Be(re);const v=await h("/signin/webauthn",{email:d});let m;try{m=await Ii(v)}catch(E){throw new Be(E)}return h("/signin/webauthn/verify",{email:d,credential:m})},refreshToken:async(l,d)=>{const v=d.type==="TRY_TOKEN"?d.token:l.refreshToken.value;return{session:await h("/token",{refreshToken:v}),error:null}},signout:(l,d)=>h("/signout",{refreshToken:l.refreshToken.value,all:!!d.all}),signUpEmailPassword:async(l,{email:d,password:v,options:m})=>{var E;return ce(d)?nr(v)?(E=l.user)!=null&&E.isAnonymous?h("/user/deanonymize",{signInMethod:"email-password",email:d,password:v,options:te(e,m)},{headers:{authorization:`Bearer ${l.accessToken.value}`}}):h("/signup/email-password",{email:d,password:v,options:te(e,m)}):Promise.reject({error:at}):Promise.reject({error:re})},signUpSecurityKey:async(l,{email:d,options:v})=>{if(!ce(d))return Promise.reject({error:re});const m=v==null?void 0:v.nickname;m&&delete v.nickname;const E=await h("/signup/webauthn",{email:d,options:v});let g;try{g=await Dr(E)}catch(w){throw new Be(w)}return h("/signup/webauthn/verify",{credential:g,options:{redirectTo:v==null?void 0:v.redirectTo,nickname:m}})},importRefreshToken:async()=>{let l=null;if(u){const v=Ke("refreshToken")||null;if(v)try{return{session:await h("/token",{refreshToken:v}),error:null}}catch(m){l=m.error}else{const m=Ke("error");if(m)return Promise.reject({session:null,error:{status:Y,error:m,message:Ke("errorDescription")||m}})}}const d=await f(Fe);if(d)try{return{session:await h("/token",{refreshToken:d}),error:null}}catch(v){return l=v.error,Promise.reject({error:l})}return l||(l=Vr),Promise.reject({error:l})}},delays:{RETRY_IMPORT_TOKEN_DELAY:({importTokenAttempts:l})=>l<5?1e3:5e3}})};class Rn{constructor({clientStorageType:e="web",autoSignIn:r=!0,autoRefreshToken:n=!0,start:i=!0,backendUrl:s,clientUrl:a,devTools:o,...u}){if(this._subscriptions=new Set,this.backendUrl=s,this.clientUrl=a,this.machine=Tn({...u,backendUrl:s,clientUrl:a,clientStorageType:e,autoSignIn:r,autoRefreshToken:n}),i&&(this.interpreter=Ir(this.machine,{devTools:o}),this.interpreter.start()),typeof window!="undefined"&&r)try{this._channel=new BroadcastChannel("nhost"),this._channel.addEventListener("message",f=>{var p;const c=(p=this.interpreter)==null?void 0:p.state.context.refreshToken.value;this.interpreter&&f.data!==c&&this.interpreter.send("TRY_TOKEN",{token:f.data})})}catch{}}get interpreter(){return this._interpreter}set interpreter(e){this._interpreter=e,e&&this._subscriptions.forEach(r=>r(this))}onStart(e){this.interpreter?e(this):this._subscriptions.add(e)}}const bn=typeof window!="undefined";class An extends Rn{constructor({...e}){super({...e,autoSignIn:bn&&e.autoSignIn,autoRefreshToken:bn&&e.autoRefreshToken,clientStorageType:"cookie"})}}const la=An,fa=async({backendUrl:t,interpreter:e},r)=>{const n=de(t);try{const{data:i}=await n.post("/user/webauthn/add",{},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}});let s;try{s=await Dr(i)}catch(o){throw new Be(o)}const{data:a}=await n.post("/user/webauthn/verify",{credential:s,nickname:r},{headers:{authorization:`Bearer ${e==null?void 0:e.state.context.accessToken.value}`}});return{key:a,isError:!1,error:null,isSuccess:!0}}catch(i){const{error:s}=i;return{isError:!0,error:s,isSuccess:!1}}},da=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,needsEmailVerification:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,needsEmailVerification:!0})})}),ha=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{password:e,ticket:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSuccess:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSuccess:!0})})}),va=t=>new Promise(e=>{t.send("GENERATE"),t.onTransition(r=>{r.matches("generated")?e({error:null,isError:!1,isGenerated:!0,qrCodeDataUrl:r.context.imageUrl||""}):r.matches({idle:"error"})&&e({error:r.context.error||null,isError:!0,isGenerated:!1,qrCodeDataUrl:""})})}),pa=(t,e)=>new Promise(r=>{t.send("ACTIVATE",{activeMfaType:"totp",code:e}),t.onTransition(n=>{n.matches({generated:"activated"})?r({error:null,isActivated:!0,isError:!1}):n.matches({generated:{idle:"error"}})&&r({error:n.context.error,isActivated:!1,isError:!0})})}),ma=async(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSent:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSent:!0})})}),ya=(t,e,r)=>new Promise(n=>{t.send("REQUEST",{email:e,options:r}),t.onTransition(i=>{i.matches({idle:"error"})?n({error:i.context.error,isError:!0,isSent:!1}):i.matches({idle:"success"})&&n({error:null,isError:!1,isSent:!0})})}),ga=t=>new Promise(e=>{const{changed:r}=t.send("SIGNIN_ANONYMOUS");r||e({isSuccess:!1,isError:!0,error:ee,user:null,accessToken:null}),t.onTransition(n=>{n.matches({authentication:"signedIn"})&&e({isSuccess:!0,isError:!1,error:null,user:n.context.user,accessToken:n.context.accessToken.value}),n.matches({authentication:{signedOut:"failed"}})&&e({isSuccess:!1,isError:!0,error:n.context.errors.authentication||null,user:null,accessToken:null})})}),Ea=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNIN_PASSWORD",{email:e,password:r});if(!i)return n({accessToken:s.accessToken.value,error:ee,isError:!0,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:s.user});t.onTransition(a=>{a.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,needsMfaOtp:!1,mfa:null,user:null}):a.matches({authentication:{signedOut:"needsMfa"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!0,mfa:a.context.mfa,user:null}):a.matches({authentication:{signedOut:"failed"}})?n({accessToken:null,error:a.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:null}):a.matches({authentication:"signedIn"})&&n({accessToken:a.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,needsMfaOtp:!1,mfa:null,user:a.context.user})})}),wa=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send("PASSWORDLESS_EMAIL",{email:e,options:r});if(!i)return n({error:ee,isError:!0,isSuccess:!1});t.onTransition(s=>{s.matches("registration.incomplete.failed")?n({error:s.context.errors.registration||null,isError:!0,isSuccess:!1}):s.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})&&n({error:null,isError:!1,isSuccess:!0})})}),Sa=(t,e)=>new Promise(r=>{const{changed:n,context:i}=t.send({type:"SIGNIN_SECURITY_KEY_EMAIL",email:e});if(!n)return r({accessToken:i.accessToken.value,error:ee,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:i.user});t.onTransition(s=>{s.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?r({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):s.matches({authentication:{signedOut:"failed"}})?r({accessToken:null,error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):s.matches({authentication:"signedIn"})&&r({accessToken:s.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:s.context.user})})}),Ta=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNIN_MFA_TOTP",{otp:e,ticket:r});if(!i)return n({accessToken:s.accessToken.value,error:ee,isError:!0,isSuccess:!1,user:s.user});t.onTransition(a=>{a.matches({authentication:{signedOut:"failed"}})?n({accessToken:null,error:a.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null}):a.matches({authentication:"signedIn"})&&n({accessToken:a.context.accessToken.value,error:null,isError:!1,isSuccess:!0,user:a.context.user})})}),Ra=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send("PASSWORDLESS_SMS",{phoneNumber:e,options:r});if(!i)return n({error:ee,isError:!0,isSuccess:!1,needsOtp:!1});t.onTransition(s=>{s.matches("registration.incomplete.needsOtp")?n({error:null,isError:!1,isSuccess:!1,needsOtp:!0}):s.matches("registration.incomplete.failed")&&n({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,needsOtp:!1})})}),ba=(t,e,r)=>new Promise(n=>{const{changed:i}=t.send({type:"PASSWORDLESS_SMS_OTP",phoneNumber:e,otp:r});if(!i)return n({error:ee,isError:!0,isSuccess:!1,user:null,accessToken:null});t.onTransition(s=>{s.matches({authentication:"signedIn"})?n({error:null,isError:!1,isSuccess:!0,user:s.context.user,accessToken:s.context.accessToken.value}):s.matches({registration:{incomplete:"failed"}})&&n({error:s.context.errors.authentication||null,isError:!0,isSuccess:!1,user:null,accessToken:null})})}),Aa=async(t,e)=>new Promise(r=>{const{event:n}=t.send("SIGNOUT",{all:e});if(n.type!=="SIGNED_OUT")return r({isSuccess:!1,isError:!0,error:Br});t.onTransition(i=>{i.matches({authentication:{signedOut:"success"}})?r({isSuccess:!0,isError:!1,error:null}):i.matches("authentication.signedOut.failed")&&r({isSuccess:!1,isError:!0,error:i.context.errors.signout||null})})}),Oa=(t,e,r,n)=>new Promise(i=>{const{changed:s,context:a}=t.send("SIGNUP_EMAIL_PASSWORD",{email:e,password:r,options:n});if(!s)return i({error:ee,accessToken:a.accessToken.value,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:a.user});t.onTransition(o=>{o.matches("registration.incomplete.failed")?i({accessToken:null,error:o.context.errors.registration||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):o.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?i({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):o.matches({authentication:"signedIn",registration:"complete"})&&i({accessToken:o.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:o.context.user})})}),xa=(t,e,r)=>new Promise(n=>{const{changed:i,context:s}=t.send("SIGNUP_SECURITY_KEY",{email:e,options:r});if(!i)return n({error:ee,accessToken:s.accessToken.value,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:s.user});t.onTransition(a=>{a.matches("registration.incomplete.failed")?n({accessToken:null,error:a.context.errors.registration||null,isError:!0,isSuccess:!1,needsEmailVerification:!1,user:null}):a.matches({authentication:{signedOut:"noErrors"},registration:{incomplete:"needsEmailVerification"}})?n({accessToken:null,error:null,isError:!1,isSuccess:!1,needsEmailVerification:!0,user:null}):a.matches({authentication:"signedIn",registration:"complete"})&&n({accessToken:a.context.accessToken.value,error:null,isError:!1,isSuccess:!0,needsEmailVerification:!1,user:a.context.user})})});S.AuthClient=Rn,S.AuthClientSSR=la,S.AuthCookieClient=An,S.CodifiedError=Be,S.EMAIL_NEEDS_VERIFICATION=Ci,S.INVALID_EMAIL_ERROR=re,S.INVALID_MFA_CODE_ERROR=jr,S.INVALID_MFA_TICKET_ERROR=$r,S.INVALID_MFA_TYPE_ERROR=Mr,S.INVALID_PASSWORD_ERROR=at,S.INVALID_PHONE_NUMBER_ERROR=$t,S.INVALID_REFRESH_TOKEN=Di,S.INVALID_SIGN_IN_METHOD=ki,S.MIN_PASSWORD_LENGTH=kr,S.NETWORK_ERROR_CODE=Mt,S.NHOST_JWT_EXPIRES_AT_KEY=Ve,S.NHOST_REFRESH_TOKEN_KEY=Fe,S.NO_MFA_TICKET_ERROR=Fr,S.NO_REFRESH_TOKEN=Vr,S.OTHER_ERROR_CODE=jt,S.REFRESH_TOKEN_RETRY_INTERVAL=Lr,S.REFRESH_TOKEN_RETRY_MAX_ATTEMPTS=_i,S.STATE_ERROR_CODE=Re,S.TOKEN_REFRESHER_RUNNING_ERROR=Ni,S.TOKEN_REFRESH_MARGIN=Ur,S.USER_ALREADY_SIGNED_IN=ee,S.USER_NOT_ANONYMOUS=Pi,S.USER_UNAUTHENTICATED=Br,S.VALIDATION_ERROR_CODE=Y,S.activateMfaPromise=pa,S.addSecurityKeyPromise=fa,S.changeEmailPromise=da,S.changePasswordPromise=ha,S.createAuthMachine=Tn,S.createChangeEmailMachine=sa,S.createChangePasswordMachine=aa,S.createEnableMfaMachine=oa,S.createResetPasswordMachine=ua,S.createSendVerificationEmailMachine=ca,S.encodeQueryParameters=wn,S.generateQrCodePromise=va,S.getParameterByName=Ke,S.localStorageGetter=gn,S.localStorageSetter=En,S.removeParameterFromWindow=rr,S.resetPasswordPromise=ma,S.rewriteRedirectTo=te,S.sendVerificationEmailPromise=ya,S.signInAnonymousPromise=ga,S.signInEmailPasswordPromise=Ea,S.signInEmailPasswordlessPromise=wa,S.signInEmailSecurityKeyPromise=Sa,S.signInMfaTotpPromise=Ta,S.signInSmsPasswordlessOtpPromise=ba,S.signInSmsPasswordlessPromise=Ra,S.signOutPromise=Aa,S.signUpEmailPasswordPromise=Oa,S.signUpEmailSecurityKeyPromise=xa,Object.defineProperties(S,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=core.umd.js.map
